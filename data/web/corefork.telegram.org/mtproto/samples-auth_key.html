<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>samples-auth_key</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="In the examples below, the transport headers are omitted:
For example, for the abridged version of the transport », the…">
    <meta property="og:title" content="samples-auth_key">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="In the examples below, the transport headers are omitted:
For example, for the abridged version of the transport », the…">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?236" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >samples-auth_key</a></li></ul></div>
  <h1 id="dev_page_title">samples-auth_key</h1>
  
  <div id="dev_page_content"><h1><a class="anchor" href="#" id="" name=""><i class="anchor-icon"></i></a></h1>
<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h1><a class="anchor" href="#1-request-req-pq-multi" id="1-request-req-pq-multi" name="1-request-req-pq-multi"><i class="anchor-icon"></i></a>1. request req_pq_multi</h1>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 00 00 00 26 8A 9C 64
0010 | 14 00 00 00 F1 8E 7E BE FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A</code></pre>
<p>Payload serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x00000000268a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>0xf18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h1><a class="anchor" href="#2-response-respq" id="2-response-respq" name="2-response-respq"><i class="anchor-icon"></i></a>2. response respq</h1>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 4C 8A 2E 26 8A 9C 64
0010 | 7C 00 00 00 63 24 16 05 FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A 19 50 DF 44 0D 63 0B 94
0030 | 1A 82 75 96 97 64 95 86 08 1B F6 DB 97 4F 6C 64
0040 | 8B 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;long&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x014c8a2e268a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x7c000000</code> (124 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>0x63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>0x081BF6DB974F6C648B000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 2015039326213923979)</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector long)</td>
<td>68, 4</td>
<td><code>0x15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>0x03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>0xA5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>0x216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>0x85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>0x85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>0x0x85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h1><a class="anchor" href="#21-decompose-p-and-q" id="21-decompose-p-and-q" name="21-decompose-p-and-q"><i class="anchor-icon"></i></a>2.1. decompose p and q</h1>
<!-- start pq -->
<pre><code>pq = 2015039326213923979</code></pre>
<p>Decompose into 2 prime cofactors: <code>1083870727 * 1859114077 = 2015039326213923979</code></p>
<pre><code>p = 1083870727
q = 1859114077</code></pre>
<!-- end pq -->
<h1><a class="anchor" href="#22-encrypted-data-generation" id="22-encrypted-data-generation" name="22-encrypted-data-generation"><i class="anchor-icon"></i></a>2.2. encrypted_data generation</h1>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1B F6 DB 97 4F 6C 64 8B 00 00 00
0010 | 04 40 9A 8E 07 00 00 00 04 6E CF D4 5D 00 00 00
0020 | FC B5 7C 8A 19 24 E6 2D B2 2C FC 63 91 60 82 0A
0030 | 19 50 DF 44 0D 63 0B 94 1A 82 75 96 97 64 95 86
0040 | 42 BE 51 23 68 86 D9 3B E2 61 F2 F7 50 29 CE 88
0050 | 85 B7 23 7E 83 87 7E 36 27 B4 EC 8E 38 80 0F C9
0060 | 02 00 00 00</code></pre>
<p>Payload serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;
p_q_inner_data_temp_dc#56fddf88 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int expires_in:int = P_Q_inner_data;
p_q_inner_data#83c95aec pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 = P_Q_inner_data;
p_q_inner_data_temp#3c6a84d4 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 expires_in:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>0x955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>0x081BF6DB974F6C648B000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 2015039326213923979)</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>0x04409A8E07000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 1083870727)</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>0x046ECFD45D000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 1859114077)</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>0x42BE51236886D93BE261F2F75029CE8885B7237E83877E3627B4EC8E38800FC9</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>0x02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 0x955FF5A9081BF6DB974F6C648B00000004409A8E07000000046ECFD45D000000FCB57C8A1924E62DB22CFC639160820A1950DF440D630B941A8275969764958642BE51236886D93BE261F2F75029CE8885B7237E83877E3627B4EC8E38800FC902000000
random_padding_bytes = 0xC76F6E64DD5720EACBD95D8252BE2ECEA94A95E4B90462634209E1004C9CB2075334B8A3226DDA5C7B0702C6C84D8673621DE603FDFA3F9FA296C067CEC07DEB23CCF47790FE51382A7EF7818AE7998FA577EAAD40930AE95D8433DF</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 0x388E852652880184BBBAF7EA6BA4CD7A5F3B3E09E26D46A1F463291C80735822576CF9366173E8345BB0A1102C765E80723A61A175840BA250AAD0AD88D8CF26D6AFD7380BB24324D9CBDC0D9AD5F880D89A4FD99E4CE303CE636032FFAE588E811EDDAC8B61C7983E5591AA945D883A65AA47BFBD507D38E7BBFB6ED516692448CDD051DC58109E9488D24DA3E633E3A00468E4600CEB1EF55B63C6DFFDAA7EC1CC5CE3FA42F656D3E5E08ED6F1625D1664D85AC229AB6EC49DAA02F97420DE361A1C42743FC4262EE2DA897C2D5861E7099AA684766A528603EBC46B5BF90F29CF8240A775E5CC3768660A8A1E6E31B23963ECA4E95608C4CF6BE05EB01414</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h1><a class="anchor" href="#3-request-req-dh-params" id="3-request-req-dh-params" name="3-request-req-dh-params"><i class="anchor-icon"></i></a>3. request req_dh_params</h1>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 04 00 00 00 26 8A 9C 64
0010 | 40 01 00 00 BE E4 12 D7 FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A 19 50 DF 44 0D 63 0B 94
0030 | 1A 82 75 96 97 64 95 86 04 40 9A 8E 07 00 00 00
0040 | 04 6E CF D4 5D 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 38 8E 85 26 52 88 01 84 BB BA F7 EA
0060 | 6B A4 CD 7A 5F 3B 3E 09 E2 6D 46 A1 F4 63 29 1C
0070 | 80 73 58 22 57 6C F9 36 61 73 E8 34 5B B0 A1 10
0080 | 2C 76 5E 80 72 3A 61 A1 75 84 0B A2 50 AA D0 AD
0090 | 88 D8 CF 26 D6 AF D7 38 0B B2 43 24 D9 CB DC 0D
00A0 | 9A D5 F8 80 D8 9A 4F D9 9E 4C E3 03 CE 63 60 32
00B0 | FF AE 58 8E 81 1E DD AC 8B 61 C7 98 3E 55 91 AA
00C0 | 94 5D 88 3A 65 AA 47 BF BD 50 7D 38 E7 BB FB 6E
00D0 | D5 16 69 24 48 CD D0 51 DC 58 10 9E 94 88 D2 4D
00E0 | A3 E6 33 E3 A0 04 68 E4 60 0C EB 1E F5 5B 63 C6
00F0 | DF FD AA 7E C1 CC 5C E3 FA 42 F6 56 D3 E5 E0 8E
0100 | D6 F1 62 5D 16 64 D8 5A C2 29 AB 6E C4 9D AA 02
0110 | F9 74 20 DE 36 1A 1C 42 74 3F C4 26 2E E2 DA 89
0120 | 7C 2D 58 61 E7 09 9A A6 84 76 6A 52 86 03 EB C4
0130 | 6B 5B F9 0F 29 CF 82 40 A7 75 E5 CC 37 68 66 0A
0140 | 8A 1E 6E 31 B2 39 63 EC A4 E9 56 08 C4 CF 6B E0
0150 | 5E B0 14 14</code></pre>
<p>Payload serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x04000000268a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>0xbee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>0x04409A8E07000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 1083870727)</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>0x046ECFD45D000000</code> (TL byte deserialization =&gt; bigendian conversion to decimal =&gt; 1859114077)</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>0x85FD64DE851D9DD0</code> (-3414540481677951611 in decimal)</td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td>0xFE000100388E852652880184BBBAF7EA6BA4CD7A5F3B3E09E26D46A1F463291C80735822576CF9366173E8345BB0A1102C765E80723A61A175840BA250AAD0AD88D8CF26D6AFD7380BB24324D9CBDC0D9AD5F880D89A4FD99E4CE303CE636032FFAE588E811EDDAC8B61C7983E5591AA945D883A65AA47BFBD507D38E7BBFB6ED516692448CDD051DC58109E9488D24DA3E633E3A00468E4600CEB1EF55B63C6DFFDAA7EC1CC5CE3FA42F656D3E5E08ED6F1625D1664D85AC229AB6EC49DAA02F97420DE361A1C42743FC4262EE2DA897C2D5861E7099AA684766A528603EBC46B5BF90F29CF8240A775E5CC3768660A8A1E6E31B23963ECA4E95608C4CF6BE05EB01414</td>
<td>See <a href="#generation-of-encrypted-data">Generation of encrypted_data »</a></td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h1><a class="anchor" href="#4-response-server-dh-params-ok" id="4-response-server-dh-params-ok" name="4-response-server-dh-params-ok"><i class="anchor-icon"></i></a>4. response server_dh_params_ok</h1>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 30 9A BA 26 8A 9C 64
0010 | 7C 02 00 00 5C 07 E8 D0 FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A 19 50 DF 44 0D 63 0B 94
0030 | 1A 82 75 96 97 64 95 86 FE 50 02 00 3E 7F CD CE
0040 | 47 75 C7 F1 4C 4C 81 A9 C2 C8 AC 52 25 7B 5B C4
0050 | 16 8E E2 0D 55 57 5D B7 7D 53 2F D5 55 41 67 57
0060 | E7 97 04 CF 24 09 45 EA 5E A0 EA AB 02 28 88 AF
0070 | C9 41 D6 B4 FE 1E 92 19 53 3B F2 63 95 BB C4 5F
0080 | D2 50 70 40 6E EA C0 E3 1A 8B 4E 2A 48 37 6D C9
0090 | 28 12 1C 10 0B 21 7F 44 BE 40 52 17 1E 0F 0B C9
00A0 | 85 97 30 97 DF 2E 12 3F 46 2D CA EA 61 BD 02 DD
00B0 | AD B2 FD 53 3F F0 A6 F1 5D 43 E1 3A DC AB 73 6C
00C0 | 7B 68 BA 83 8C 5C D8 A2 79 66 E4 63 B0 41 6F C7
00D0 | FE D8 28 5A EB AA 9B 8B AA EB 6B AF FF A5 8B D4
00E0 | 95 26 7F 55 87 8F 71 44 04 3F 8B FD B2 BE 0B A0
00F0 | 1F 75 96 59 61 8D BD 21 80 7A 7B 06 36 C6 05 8B
0100 | 09 77 D8 74 7B CC 06 19 EA 71 3E C0 09 36 28 95
0110 | 25 6A F3 31 7F AA F3 A7 93 BC F3 40 31 A9 13 33
0120 | 39 DE 68 56 2B 64 F0 61 1E 48 36 5B 20 C8 B2 66
0130 | 0C 3C AE 74 16 8D E2 7D 6E A2 14 41 F9 23 52 79
0140 | 6F 47 09 F3 A0 B7 0A 84 A5 72 D4 2E 44 57 9A A0
0150 | 1D 26 8B 92 D8 04 A8 56 4F 1D 78 90 87 18 3C 8D
0160 | 35 9B 03 EB 24 A3 4B 89 2D 42 60 13 4C D4 D9 53
0170 | D4 11 FA 61 11 96 B4 23 99 0D AB C3 F0 B0 CA BA
0180 | DA C6 81 AE 77 7F C3 D8 52 18 66 04 7B 5D 14 79
0190 | DA 61 E9 AC C2 8D FA 3A 30 48 E7 12 E3 5C 58 B9
01A0 | 80 E5 56 6D BF D8 2C 73 31 04 EF 0F 69 39 D7 1C
01B0 | 0B 5A 31 B2 53 DE A2 DD 19 4A BD E5 C6 45 70 1D
01C0 | 17 FE CA 5E 0C DA 04 3D D0 8F A0 F3 25 6C FF 58
01D0 | B9 A9 F2 38 14 C1 DA 4F C9 0C DC 10 B0 33 45 6F
01E0 | 36 1E 77 D4 10 57 3A 3E 8B 73 2D 54 02 6E E7 7D
01F0 | CA E6 95 DE F7 72 E9 06 EA 7B 2B B6 F2 A6 34 77
0200 | 2F 72 C0 D5 37 20 96 75 71 3A 4C E0 45 67 63 6E
0210 | 25 AD AA E4 77 D1 73 65 36 E9 B1 78 CF 20 ED BB
0220 | 66 25 05 C0 63 E5 E3 64 FD 45 0E 8F A4 90 CC A4
0230 | 2D 56 F9 76 88 F5 7F 41 27 91 FB 91 78 BD 2A 6F
0240 | F1 E7 51 21 69 5C F6 59 5C 8B 50 A6 DC 9A 5B 66
0250 | 89 8E D1 4B 20 E1 32 B9 B4 9B 72 9A 6B F8 2B 9F
0260 | 02 25 59 4C 8F 6C AF 82 D7 1B A7 0C 56 88 AB F9
0270 | 0D 59 3C EA 46 6E FE 62 92 A5 D5 26 8A 14 CA 29
0280 | D7 93 82 36 1B 9B 24 E5 37 CF F2 F5</code></pre>
<p>Payload serialization:</p>
<pre><code>server_DH_params_fail#79cb045d nonce:int128 server_nonce:int128 new_nonce_hash:int128 = Server_DH_Params;
server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x01309aba268a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x7c020000</code> (636 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>0x5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td>0xFE5002003E7FCDCE4775C7F14C4C81A9C2C8AC52257B5BC4168EE20D55575DB77D532FD555416757E79704CF240945EA5EA0EAAB022888AFC941D6B4FE1E9219533BF26395BBC45FD25070406EEAC0E31A8B4E2A48376DC928121C100B217F44BE4052171E0F0BC985973097DF2E123F462DCAEA61BD02DDADB2FD533FF0A6F15D43E13ADCAB736C7B68BA838C5CD8A27966E463B0416FC7FED8285AEBAA9B8BAAEB6BAFFFA58BD495267F55878F7144043F8BFDB2BE0BA01F759659618DBD21807A7B0636C6058B0977D8747BCC0619EA713EC009362895256AF3317FAAF3A793BCF34031A9133339DE68562B64F0611E48365B20C8B2660C3CAE74168DE27D6EA21441F92352796F4709F3A0B70A84A572D42E44579AA01D268B92D804A8564F1D789087183C8D359B03EB24A34B892D4260134CD4D953D411FA611196B423990DABC3F0B0CABADAC681AE777FC3D8521866047B5D1479DA61E9ACC28DFA3A3048E712E35C58B980E5566DBFD82C733104EF0F6939D71C0B5A31B253DEA2DD194ABDE5C645701D17FECA5E0CDA043DD08FA0F3256CFF58B9A9F23814C1DA4FC90CDC10B033456F361E77D410573A3E8B732D54026EE77DCAE695DEF772E906EA7B2BB6F2A634772F72C0D537209675713A4CE04567636E25ADAAE477D1736536E9B178CF20EDBB662505C063E5E364FD450E8FA490CCA42D56F97688F57F412791FB9178BD2A6FF1E75121695CF6595C8B50A6DC9A5B66898ED14B20E132B9B49B729A6BF82B9F0225594C8F6CAF82D71BA70C5688ABF90D593CEA466EFE6292A5D5268A14CA29D79382361B9B24E537CFF2F5</td>
<td>See <a href="#conversion-of-encrypted-answer-into-answer">Decomposition of encrypted_answer »</a></td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<h1><a class="anchor" href="#41-server-dh-inner-data-decryption-and-deserialization" id="41-server-dh-inner-data-decryption-and-deserialization" name="41-server-dh-inner-data-decryption-and-deserialization"><i class="anchor-icon"></i></a>4.1 server_dh_inner_data decryption and deserialization</h1>
<p>Decrypt <code>encrypted_answer</code> using the process specified in step 5.</p>
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 FC B5 7C 8A 19 24 E6 2D B2 2C FC 63
0010 | 91 60 82 0A 19 50 DF 44 0D 63 0B 94 1A 82 75 96
0020 | 97 64 95 86 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 50 02 DA C7 09 FE 68 6A EB 84 BC FB AA 32 8A E6
0140 | 1C 83 29 F8 99 AA A5 B2 1E 75 D0 2A 1D 5D AC 70
0150 | D2 AB 13 0A 7E C4 E1 63 A2 62 9A F0 CF 91 DD E8
0160 | D4 5C B9 A7 F4 A8 1C 49 1E 7B 92 11 DC 9B 3C 48
0170 | 9E 09 CA FC 0A 35 51 37 AA A5 5B 7D 2B 10 F2 AC
0180 | 38 47 1A C7 AA 29 CB 62 FA 8F 0D 46 8C F8 D8 AF
0190 | 64 E2 93 37 60 24 86 BB 8F 8C BD 6D 62 8C 68 47
01A0 | E4 9B 2D 8D 19 D3 55 67 3B EC 5A 72 0D 09 CB F9
01B0 | 1C D5 98 DB 80 FE A5 B6 BF 4A F4 3D 61 DC 51 E3
01C0 | D8 FC 64 E0 BF EF 09 B2 C0 EA D6 D2 93 EC B0 95
01D0 | 2A CC 69 5B F6 C0 14 CF 93 88 4D 56 8A 95 A9 AE
01E0 | 6E 28 65 DD 26 D5 B6 33 42 DA 79 32 6D DC D9 73
01F0 | 14 7D 6F 28 D5 4B 0A A2 F5 90 9D 3D 8D 48 2A 03
0200 | 5C 6F 2C 67 54 BD 6B AD 23 80 8E 6B E6 96 86 C0
0210 | CD BD 98 28 9F 8F E7 80 32 EC 3D AF 96 E9 B6 AF
0220 | F3 81 14 29 22 C2 A3 90 BC 57 E7 96 AE D5 5B DD
0230 | 26 8A 9C 64</code></pre>
<p>Payload serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>0xba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>0x03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td>0xFE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5B</td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td>0xFE0001005002DAC709FE686AEB84BCFBAA328AE61C8329F899AAA5B21E75D02A1D5DAC70D2AB130A7EC4E163A2629AF0CF91DDE8D45CB9A7F4A81C491E7B9211DC9B3C489E09CAFC0A355137AAA55B7D2B10F2AC38471AC7AA29CB62FA8F0D468CF8D8AF64E29337602486BB8F8CBD6D628C6847E49B2D8D19D355673BEC5A720D09CBF91CD598DB80FEA5B6BF4AF43D61DC51E3D8FC64E0BFEF09B2C0EAD6D293ECB0952ACC695BF6C014CF93884D568A95A9AE6E2865DD26D5B63342DA79326DDCD973147D6F28D54B0AA2F5909D3D8D482A035C6F2C6754BD6BAD23808E6BE69686C0CDBD98289F8FE78032EC3DAF96E9B6AFF381142922C2A390BC57E796AED55BDD</td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>0x268A9C64</code> (1687980582 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h1><a class="anchor" href="#42-random-2048-bit-number-b-is-generated" id="42-random-2048-bit-number-b-is-generated" name="42-random-2048-bit-number-b-is-generated"><i class="anchor-icon"></i></a>4.2. random 2048-bit number b is generated:</h1>
<!-- start b -->
<pre><code>b = 0xBF21123EA6D16A4A5B083C07D8DA057598973ED1574E7498957653128FA0ED98FB46B27FB084C5DBEE3AE0FED8283D37E5AF1CB022967FF3504A8C5BB1EF359E71CF2218121E85C4450CBBA9CC6D0C3FC55EB690982945C7A19CCF6ACFE857F8C3BE7DA33F89A69C3DA5CF99651602E1EE54E3ED45B44DA21B8711714F61B20F82E345E19877F723751277DECA38B4F3945ED385CE7413810C75636B7A6B91CD6F3D0B2C76504E2814C48D271A22E58723362CFA7C2D3E89CBAC8CA7EEE144DCEBA6D5362FD97941F3D50620EB85EF4EAD6A8866F0547D697AA399188DB8FE78F0E530A1A9FF77C23FCAACE4D67A5ED85F740525553D8F7F9ECA9D5E36140401</code></pre>
<!-- end b -->
<h1><a class="anchor" href="#43-generation-of-encrypted-data" id="43-generation-of-encrypted-data" name="43-generation-of-encrypted-data"><i class="anchor-icon"></i></a>4.3 generation of encrypted_data</h1>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 FC B5 7C 8A 19 24 E6 2D B2 2C FC 63
0010 | 91 60 82 0A 19 50 DF 44 0D 63 0B 94 1A 82 75 96
0020 | 97 64 95 86 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 63 50 22 33 D1 89 A0 53 FD E1 86 0B 8B 32 50 0D
0040 | 0B 46 4C F9 D0 A2 F7 26 EB 11 BF 1A 04 5E 74 94
0050 | 2B EC 00 92 36 38 E8 D5 73 87 D2 3B 28 DB BD 12
0060 | 4E 33 B2 34 98 33 ED CA DF C5 3A 31 20 AD AE EA
0070 | 51 95 72 FC DB D8 96 B3 12 41 60 24 B9 51 01 A0
0080 | 70 AE 92 6D 28 12 98 66 10 93 D8 5C 78 68 6B 89
0090 | 2F EA EC A3 20 32 7B 2E 63 C2 AB 14 81 F5 58 B4
00A0 | F1 DF 5D 58 57 F1 D0 52 98 63 A3 08 B4 87 31 2D
00B0 | 80 3E 99 20 2C C7 35 0F 7A 20 FB 58 AE 3B 21 20
00C0 | C6 4C 88 44 F4 4F A4 1A D8 4A B4 EE 5B C7 A0 E8
00D0 | A6 51 51 01 1C E1 6D E9 42 BA D3 1B 41 74 79 BD
00E0 | B3 32 65 8D 38 9D A9 77 AC 4E 9B C4 AA 97 DE 49
00F0 | 88 9F BC 41 CB 4E 47 B6 78 FE EA 95 52 5A 87 52
0100 | 9D E7 B3 B2 F7 72 9C 56 81 EC 19 61 1E B5 30 FF
0110 | E4 5C CD 98 34 39 07 2B AA DA C7 8D 48 57 2C B3
0120 | 41 0D 2A 83 9C 47 63 89 31 7E 99 70 2B B6 8D E2</code></pre>
<p>Payload serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>0x54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td>0xFE00010063502233D189A053FDE1860B8B32500D0B464CF9D0A2F726EB11BF1A045E74942BEC00923638E8D57387D23B28DBBD124E33B2349833EDCADFC53A3120ADAEEA519572FCDBD896B312416024B95101A070AE926D281298661093D85C78686B892FEAECA320327B2E63C2AB1481F558B4F1DF5D5857F1D0529863A308B487312D803E99202CC7350F7A20FB58AE3B2120C64C8844F44FA41AD84AB4EE5BC7A0E8A65151011CE16DE942BAD31B417479BDB332658D389DA977AC4E9BC4AA97DE49889FBC41CB4E47B678FEEA95525A87529DE7B3B2F7729C5681EC19611EB530FFE45CCD983439072BAADAC78D48572CB3410D2A839C476389317E99702BB68DE2</td>
<td><code>pow(g, b) mod dh_prime</code></td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0x0000000000000000</code> (0 in decimal)</td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 9).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces some string <strong>data</strong>. This is followed by <strong>encrypted_data</strong>:</p>
<pre><code>data_with_hash := SHA1(data) + data + (0-15 random bytes); such that the length be divisible by 16;
AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv) = 928A4957D0463B525C1CC48AABAA030A256BE5C746792C84CA4C5A0DF60AC799048D98A38A8480EDCF082214DFC79DCB9EE34E206513E2B3BC1504CFE6C9ADA46BF9A03CA74F192EAF8C278454ADABC795A566615462D31817382984039505F71CB33A41E2527A4B1AC05107872FED8E3ABCEE1518AE965B0ED3AED7F67479155BDA8E4C286B64CDF123EC748CF289B1DB02D1907B562DF462D8582BA6F0A3022DC2D3504D69D1BA48B677E3A830BFAFD67584C8AA24E1344A8904E305F9587C92EF964F0083F50F61EAB4A393EAA33C9270294AEDC7732891D4EA1599F52311D74469D2112F4EDF3F342E93C8E87E812DC3989BAECFE6740A46077524C75093F5A5405736DE8937BB6E42C9A0DCF22CA53227D462BCCC2CFE94B6FE86AB7FBFA395021F66661AF7C0024CA2986CA03F3476905407D1EA9C010B763258DB1AA2CC7826D91334EFC1FDC665B67FE45ED0</code></pre>
<p>The length of the final string is 336 bytes.</p>
<h1><a class="anchor" href="#5-request-set-client-dh-params" id="5-request-set-client-dh-params" name="5-request-set-client-dh-params"><i class="anchor-icon"></i></a>5. request set_client_dh_params</h1>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 08 00 00 00 26 8A 9C 64
0010 | 78 01 00 00 1F 5F 04 F5 FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A 19 50 DF 44 0D 63 0B 94
0030 | 1A 82 75 96 97 64 95 86 FE 50 01 00 BC E0 FD 22
0040 | 38 D8 27 BB C7 D4 AB E0 A0 2D F4 66 32 3A E9 C7
0050 | 8A 73 5B AA CF E1 46 37 10 D9 18 53 81 29 6B 21
0060 | 50 FA AD A2 0A 11 4D A6 31 C3 85 F1 1C B8 82 1A
0070 | B7 6E C9 FC F2 9D 7A AB 83 4C 20 CA CC 73 3E 48
0080 | 4F CC 66 78 CB 65 AD 95 0C 3A B3 65 48 8C 39 82
0090 | 69 4A BF 33 F7 7D B0 03 95 4B 3C 73 F2 7F AA 98
00A0 | 6C F9 0D 5E C5 82 B4 2D B7 74 B0 87 D5 84 C1 E7
00B0 | 3E 1A 4D C6 99 59 E8 7B 00 B1 21 4E F6 16 4A 4C
00C0 | 02 DA F4 BF E5 A0 99 37 9E 7D E2 73 33 31 43 C3
00D0 | 2F F9 97 83 53 90 E1 93 11 96 1C EF 90 9A E0 FB
00E0 | 30 23 1F 67 6B FE 55 E1 DA E1 38 3F FE 49 0A 4F
00F0 | 88 FA 0F E2 82 D4 C4 60 E7 A0 16 D0 15 D9 71 85
0100 | 68 0C 86 28 6F F6 C5 73 FA 4C FA 29 BD 81 FB 85
0110 | A0 E2 24 B7 08 1E 70 1C DE 0C EB 6A B0 23 5E 6D
0120 | A8 82 83 D3 42 A0 EA 74 CB 15 B0 B7 C8 0B 0D 25
0130 | C5 C6 B4 47 A7 8C 63 0E 8D F1 F5 EA 72 C6 F8 71
0140 | F7 C5 DA F8 3F 49 57 2A 4B 9A 37 4E 4D 6B 59 AC
0150 | C4 26 7A 2D 2A C4 1B 46 28 8E 85 AA C5 69 85 9C
0160 | 54 1B E0 3A F5 37 BE F4 69 F6 4A C5 DE FA 14 B8
0170 | 8C 6E 30 19 7E 1C 17 AA A2 E4 90 4D 5E FF 32 30
0180 | 20 D6 92 4C 56 6B D9 2E 5B E2 57 B8</code></pre>
<p>Payload serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x08000000268a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>0x1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td>0xFE500100BCE0FD2238D827BBC7D4ABE0A02DF466323AE9C78A735BAACFE1463710D9185381296B2150FAADA20A114DA631C385F11CB8821AB76EC9FCF29D7AAB834C20CACC733E484FCC6678CB65AD950C3AB365488C3982694ABF33F77DB003954B3C73F27FAA986CF90D5EC582B42DB774B087D584C1E73E1A4DC69959E87B00B1214EF6164A4C02DAF4BFE5A099379E7DE273333143C32FF997835390E19311961CEF909AE0FB30231F676BFE55E1DAE1383FFE490A4F88FA0FE282D4C460E7A016D015D97185680C86286FF6C573FA4CFA29BD81FB85A0E224B7081E701CDE0CEB6AB0235E6DA88283D342A0EA74CB15B0B7C80B0D25C5C6B447A78C630E8DF1F5EA72C6F871F7C5DAF83F49572A4B9A374E4D6B59ACC4267A2D2AC41B46288E85AAC569859C541BE03AF537BEF469F64AC5DEFA14B88C6E30197E1C17AAA2E4904D5EFF323020D6924C566BD92E5BE257B8</td>
<td>Encrypted client_DH_inner_data, generated as follows</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h1><a class="anchor" href="#6-auth-key-generation" id="6-auth-key-generation" name="6-auth-key-generation"><i class="anchor-icon"></i></a>6. auth key generation</h1>
<p>The clients computes the auth_key using formula <code>g^{ab} mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 0x67084A6AC73ADB4F6F024825C0FBE8393D57D222A167784B71C03EA1F82F58DF072A7E6D7B12F9755AA58B2E9EB10951A917F55946C7306A3E2B233DA31FFE7FA1D1F5130BFB31163841E2F2BBD7E3175083F90188E96D133693C7DE938A25938F4AAF8AD7A2F249BFC3173E96BBB7BA90DE1DD7595A6F62EC3CCB7FE2230615B7DE3717E360CDA00A1B8AA79DE784B3D50D1F651C9444376EFC8F7C1B8CBDC43B207F081072A8C3FEEE62F84C180D3E46C8E66586D336D97E3BE1D3AAF2E4F238C0187B00219167449F46CE462B493E82C3EF897769CE698178B2EA316AE228ECE4BC209A98C64EF7BAE32403B2FE1965CE899EA96EB9B61C283B14C2DA27F7</code></pre>
<!-- end auth_key -->
<h1><a class="anchor" href="#7-reply-set-client-dh-params-answer" id="7-reply-set-client-dh-params-answer" name="7-reply-set-client-dh-params-answer"><i class="anchor-icon"></i></a>7. reply set_client_dh_params_answer</h1>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 D4 2A 11 27 8A 9C 64
0010 | 4C 00 00 00 34 F7 CB 3B FC B5 7C 8A 19 24 E6 2D
0020 | B2 2C FC 63 91 60 82 0A 19 50 DF 44 0D 63 0B 94
0030 | 1A 82 75 96 97 64 95 86 DC 0E A4 DD 44 3A 6A 18
0040 | E3 A3 7B 86 83 D7 FD 0A</code></pre>
<p>Payload serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;
dh_gen_retry#46dc1fb9 nonce:int128 server_nonce:int128 new_nonce_hash2:int128 = Set_client_DH_params_answer;
dh_gen_fail#a69dae02 nonce:int128 server_nonce:int128 new_nonce_hash3:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0x0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0x01d42a11278a9c64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>0x4c000000</code> (76 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>0x34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>0xFCB57C8A1924E62DB22CFC639160820A</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0x1950DF440D630B941A82759697649586</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>0xDC0EA4DD443A6A18E3A37B8683D7FD0A</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)">Twitter</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    
    <script>backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

