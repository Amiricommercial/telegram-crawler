<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?236" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 A3 0B 00 68 2B 88 65
0010 | 14 00 00 00 F1 8E 7E BE 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>00A30B00682B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 18 AD F8 68 2B 88 65
0010 | CC 00 00 00 63 24 16 05 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60 2F 63 0E FC 18 D8 3F 59
0030 | 08 18 FE 24 F6 6F 01 7A 08 1F E2 54 46 76 91 C4
0040 | A9 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0118ADF8682B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>CC000000</code> (204 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081FE254467691C4A9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2297491421526082729</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2297491421526082729</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2297491421526082729 = 1266380771 * 1814218499</code></p>
<pre><code>p = 1266380771
q = 1814218499</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1F E2 54 46 76 91 C4 A9 00 00 00
0010 | 04 4B 7B 6F E3 00 00 00 04 6C 22 C7 03 00 00 00
0020 | 92 F0 49 59 80 B4 76 E4 6B DF 65 7D 07 70 71 60
0030 | 2F 63 0E FC 18 D8 3F 59 08 18 FE 24 F6 6F 01 7A
0040 | 89 0B EA EA BD 5B 69 76 A6 C5 C8 81 CF 33 A0 DA
0050 | 76 17 6E 00 E9 FD 04 69 DC E4 8B 84 6D 2E 5D 5C
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081FE254467691C4A9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2297491421526082729</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>044B7B6FE3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1266380771</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046C22C703000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1814218499</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>890BEAEABD5B6976A6C5C881CF33A0DA</code> <code>76176E00E9FD0469DCE48B846D2E5D5C</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081FE254467691C4A9000000044B7B6FE3000000046C22C70300000092F0495980B476E46BDF657D077071602F630EFC18D83F590818FE24F66F017A890BEAEABD5B6976A6C5C881CF33A0DA76176E00E9FD0469DCE48B846D2E5D5C02000000
random_padding_bytes = 86C4B7EED21EC45F0C30C385989248950C2C53001603D28ECBDC8DA82485EBE51074D3FC1976F4438D627D86849DB9289669247AE2C6EEF1E240D82E578B332A791ABF5C5C7D1AA4167143C80915155778106B6D40EF01C9C11618E4</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 5B9412A8C31EE8ECD66EB148789C4C76F35A3A8F3F32A70E3F311369E9AD3545E60F527923112BA22F651632DE61DA429282A3CA7E86FDF3905088E338B415985DB8D57CDB3E993D4C6C25169277446FC1058B108FFFD6734615B27B0901F07B37FBCF05DDC8D6AD7B8C6B22A13AC74FCAEA972BEA4530D8004D63DBC93B484DABB91AF5B436983DA08E34825F725D2C751313FD49C708AAB9144F4E50D31D7B6FEED1EAF42AC6E76FF52D275FE3DBAE6B3119A6FDCDF9CB898393774E10F2A8F57996A0FDACDCFB22FA1F2908117A50CEA79A35D7752DD0E13A3B68DFBED5C39DF19ED757881E359A8679F9A0EA37CFAA7FE59122C922B52F2E5C4808E8540A</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 C8 E1 07 00 69 2B 88 65
0010 | 40 01 00 00 BE E4 12 D7 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60 2F 63 0E FC 18 D8 3F 59
0030 | 08 18 FE 24 F6 6F 01 7A 04 4B 7B 6F E3 00 00 00
0040 | 04 6C 22 C7 03 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 5B 94 12 A8 C3 1E E8 EC D6 6E B1 48
0060 | 78 9C 4C 76 F3 5A 3A 8F 3F 32 A7 0E 3F 31 13 69
0070 | E9 AD 35 45 E6 0F 52 79 23 11 2B A2 2F 65 16 32
0080 | DE 61 DA 42 92 82 A3 CA 7E 86 FD F3 90 50 88 E3
0090 | 38 B4 15 98 5D B8 D5 7C DB 3E 99 3D 4C 6C 25 16
00A0 | 92 77 44 6F C1 05 8B 10 8F FF D6 73 46 15 B2 7B
00B0 | 09 01 F0 7B 37 FB CF 05 DD C8 D6 AD 7B 8C 6B 22
00C0 | A1 3A C7 4F CA EA 97 2B EA 45 30 D8 00 4D 63 DB
00D0 | C9 3B 48 4D AB B9 1A F5 B4 36 98 3D A0 8E 34 82
00E0 | 5F 72 5D 2C 75 13 13 FD 49 C7 08 AA B9 14 4F 4E
00F0 | 50 D3 1D 7B 6F EE D1 EA F4 2A C6 E7 6F F5 2D 27
0100 | 5F E3 DB AE 6B 31 19 A6 FD CD F9 CB 89 83 93 77
0110 | 4E 10 F2 A8 F5 79 96 A0 FD AC DC FB 22 FA 1F 29
0120 | 08 11 7A 50 CE A7 9A 35 D7 75 2D D0 E1 3A 3B 68
0130 | DF BE D5 C3 9D F1 9E D7 57 88 1E 35 9A 86 79 F9
0140 | A0 EA 37 CF AA 7F E5 91 22 C9 22 B5 2F 2E 5C 48
0150 | 08 E8 54 0A</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>C8E10700692B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>044B7B6FE3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1266380771</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046C22C703000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1814218499</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE0001005B9412A8C31EE8ECD66EB148</code> <code>789C4C76F35A3A8F3F32A70E3F311369</code> <code>E9AD3545E60F527923112BA22F651632</code> <code>DE61DA429282A3CA7E86FDF3905088E3</code> <code>38B415985DB8D57CDB3E993D4C6C2516</code> <code>9277446FC1058B108FFFD6734615B27B</code> <code>0901F07B37FBCF05DDC8D6AD7B8C6B22</code> <code>A13AC74FCAEA972BEA4530D8004D63DB</code> <code>C93B484DABB91AF5B436983DA08E3482</code> <code>5F725D2C751313FD49C708AAB9144F4E</code> <code>50D31D7B6FEED1EAF42AC6E76FF52D27</code> <code>5FE3DBAE6B3119A6FDCDF9CB89839377</code> <code>4E10F2A8F57996A0FDACDCFB22FA1F29</code> <code>08117A50CEA79A35D7752DD0E13A3B68</code> <code>DFBED5C39DF19ED757881E359A8679F9</code> <code>A0EA37CFAA7FE59122C922B52F2E5C48</code><br> <code>08E8540A</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 94 76 BD 69 2B 88 65
0010 | 94 02 00 00 5C 07 E8 D0 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60 2F 63 0E FC 18 D8 3F 59
0030 | 08 18 FE 24 F6 6F 01 7A FE 50 02 00 13 45 C3 6E
0040 | 4F A8 9C B1 A6 92 04 0F EB ED 93 5A 8B DF DA FB
0050 | 4D 49 0C 0B 8C BC B8 B7 47 40 71 29 C2 8B 97 59
0060 | 5A ED 04 0C 36 86 46 5E B0 E4 1E 9F AD 13 6C 00
0070 | 16 60 A7 BC 78 A7 89 BE CD 3E 21 FF 7C 5C 03 E6
0080 | EC 86 D0 B7 C0 F7 B0 EF 24 2C 1A E8 67 CB 55 80
0090 | 05 A3 CE 0A EE 71 9F 76 E0 DE 0F 93 51 8C AE 54
00A0 | 35 D5 7A AE 85 50 DF D1 76 D5 85 0D 91 62 FE EC
00B0 | FF F0 3A 62 BB A5 E9 37 19 BC F4 80 C3 9F 8F 5D
00C0 | D7 3B F9 D4 56 AB 2A 41 33 2C 80 B8 1A 41 19 EF
00D0 | 68 6B 83 E1 58 AB 41 0A 33 6F AF 67 E1 2C D3 F8
00E0 | 5C CB 39 EE 55 3C 2F 36 7C 21 6C 9A 24 18 81 DF
00F0 | F5 F9 68 88 E1 58 CD EF 64 0A 69 B9 8E 3D 5E 66
0100 | 3B 90 0B 8E 92 C9 4D 84 92 96 24 AE 28 8E D7 86
0110 | 26 45 2F 76 0E CB EB F2 F2 35 D4 32 DB 14 14 70
0120 | F0 67 76 A7 84 8C 63 23 EC 93 29 62 39 86 88 1D
0130 | FE 2F EC 38 DE 7B 83 99 C5 7E B5 A7 7B 66 84 6F
0140 | 92 E3 E1 67 74 1A 07 BA F0 FC CA FA EC 06 D3 1B
0150 | 54 56 30 11 9D A3 A1 E7 9B 68 47 31 47 E9 A1 BA
0160 | BB 6C 8B 77 05 1F 4F D5 0C 69 43 63 8E FE 96 46
0170 | 61 6C 53 5E C7 22 1D E0 93 69 82 63 14 B7 B0 7B
0180 | 12 D4 1F 29 62 E6 8D 91 D8 CD 0B 38 A4 E7 D7 85
0190 | 16 F4 8F 55 F4 C2 77 99 E0 22 B1 2B 33 F5 A1 CB
01A0 | FD 2D 72 0B 06 28 4B 49 CB 2B C4 9A 72 C9 48 69
01B0 | 05 E3 4C 85 7A C1 A0 F8 8D 15 F4 69 64 A4 F6 F5
01C0 | EA 6C F8 C1 35 0A F6 F9 93 05 91 8D 0A 55 E2 1E
01D0 | D8 61 DB D9 1E C5 55 B9 78 D2 DF 8D 4E CB B5 12
01E0 | 41 BF 9F E9 DA 2E 61 C8 C9 C8 33 4E DB D7 8D E9
01F0 | 34 8A 91 7B A3 87 5C A0 F4 03 AE EF 4A 21 BD 22
0200 | CB B8 34 BA 75 A9 F0 27 74 A5 AF 1F 29 F9 30 97
0210 | EE DC BF 9B BB 8D 4E A1 C5 9A AB 26 19 50 AF 03
0220 | C9 3A CB 6C F1 FC 46 CD 8A A8 13 18 03 CA E5 3D
0230 | 1C 31 B7 83 8C 7A 26 69 13 D2 88 89 2F F3 BC DF
0240 | BC B4 34 EE E6 48 36 17 9C C2 70 55 BB E1 D0 BC
0250 | 56 33 01 5A 29 27 0C 58 E5 D3 5B C0 4F 00 87 C9
0260 | 51 59 54 8E 11 8D 1C CE 4D 17 8D 90 60 E8 5E A6
0270 | 96 7B ED 40 48 FF 8F 75 DB BC A2 61 C1 4E 65 D6
0280 | 71 99 69 E2 8A BF BC 21 2C 2B 21 90</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>019476BD692B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>94020000</code> (660 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002001345C36E4FA89CB1A692040F</code> <code>EBED935A8BDFDAFB4D490C0B8CBCB8B7</code> <code>47407129C28B97595AED040C3686465E</code> <code>B0E41E9FAD136C001660A7BC78A789BE</code> <code>CD3E21FF7C5C03E6EC86D0B7C0F7B0EF</code> <code>242C1AE867CB558005A3CE0AEE719F76</code> <code>E0DE0F93518CAE5435D57AAE8550DFD1</code> <code>76D5850D9162FEECFFF03A62BBA5E937</code> <code>19BCF480C39F8F5DD73BF9D456AB2A41</code> <code>332C80B81A4119EF686B83E158AB410A</code> <code>336FAF67E12CD3F85CCB39EE553C2F36</code> <code>7C216C9A241881DFF5F96888E158CDEF</code> <code>640A69B98E3D5E663B900B8E92C94D84</code> <code>929624AE288ED78626452F760ECBEBF2</code> <code>F235D432DB141470F06776A7848C6323</code> <code>EC9329623986881DFE2FEC38DE7B8399</code> <code>C57EB5A77B66846F92E3E167741A07BA</code> <code>F0FCCAFAEC06D31B545630119DA3A1E7</code> <code>9B68473147E9A1BABB6C8B77051F4FD5</code> <code>0C6943638EFE9646616C535EC7221DE0</code> <code>9369826314B7B07B12D41F2962E68D91</code> <code>D8CD0B38A4E7D78516F48F55F4C27799</code> <code>E022B12B33F5A1CBFD2D720B06284B49</code> <code>CB2BC49A72C9486905E34C857AC1A0F8</code> <code>8D15F46964A4F6F5EA6CF8C1350AF6F9</code> <code>9305918D0A55E21ED861DBD91EC555B9</code> <code>78D2DF8D4ECBB51241BF9FE9DA2E61C8</code> <code>C9C8334EDBD78DE9348A917BA3875CA0</code> <code>F403AEEF4A21BD22CBB834BA75A9F027</code> <code>74A5AF1F29F93097EEDCBF9BBB8D4EA1</code> <code>C59AAB261950AF03C93ACB6CF1FC46CD</code> <code>8AA8131803CAE53D1C31B7838C7A2669</code> <code>13D288892FF3BCDFBCB434EEE6483617</code> <code>9CC27055BBE1D0BC5633015A29270C58</code> <code>E5D35BC04F0087C95159548E118D1CCE</code> <code>4D178D9060E85EA6967BED4048FF8F75</code> <code>DBBCA261C14E65D6719969E28ABFBC21</code><br> <code>2C2B2190</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 1345C36E4FA89CB1A692040FEBED935A8BDFDAFB4D490C0B8CBCB8B747407129C28B97595AED040C3686465EB0E41E9FAD136C001660A7BC78A789BECD3E21FF7C5C03E6EC86D0B7C0F7B0EF242C1AE867CB558005A3CE0AEE719F76E0DE0F93518CAE5435D57AAE8550DFD176D5850D9162FEECFFF03A62BBA5E93719BCF480C39F8F5DD73BF9D456AB2A41332C80B81A4119EF686B83E158AB410A336FAF67E12CD3F85CCB39EE553C2F367C216C9A241881DFF5F96888E158CDEF640A69B98E3D5E663B900B8E92C94D84929624AE288ED78626452F760ECBEBF2F235D432DB141470F06776A7848C6323EC9329623986881DFE2FEC38DE7B8399C57EB5A77B66846F92E3E167741A07BAF0FCCAFAEC06D31B545630119DA3A1E79B68473147E9A1BABB6C8B77051F4FD50C6943638EFE9646616C535EC7221DE09369826314B7B07B12D41F2962E68D91D8CD0B38A4E7D78516F48F55F4C27799E022B12B33F5A1CBFD2D720B06284B49CB2BC49A72C9486905E34C857AC1A0F88D15F46964A4F6F5EA6CF8C1350AF6F99305918D0A55E21ED861DBD91EC555B978D2DF8D4ECBB51241BF9FE9DA2E61C8C9C8334EDBD78DE9348A917BA3875CA0F403AEEF4A21BD22CBB834BA75A9F02774A5AF1F29F93097EEDCBF9BBB8D4EA1C59AAB261950AF03C93ACB6CF1FC46CD8AA8131803CAE53D1C31B7838C7A266913D288892FF3BCDFBCB434EEE64836179CC27055BBE1D0BC5633015A29270C58E5D35BC04F0087C95159548E118D1CCE4D178D9060E85EA6967BED4048FF8F75DBBCA261C14E65D6719969E28ABFBC212C2B2190
tmp_aes_key = 3A2455F86992C73BB43A2A7A7397E18CD56E1756616A3CBF4F601F32E08176B7
tmp_aes_iv = EBE760B2B410B8ADE48EC7F9702FF9B9E76D9E5C4C18FD3ACE47DF2A890BEAEA</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 6A51F258B5F58C53F4C54618B948DB07A5393D9CBA0D89B592F0495980B476E46BDF657D077071602F630EFC18D83F590818FE24F66F017A03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100232939B8A5969CA74982302C5B03AC4A9F14E18E0D75EC871CEACDF00B02BE7D1892EAC44715DA81D27D1D6EFAE52DEB320BB4D09B126E1E560BC672E0DB586F1D6ED0B7374595F1B53E0EDDC9F5C33C79F673BE0511A5839A2791AF995D18FE10BCA1274A28E8CF147287D4F38A3C4BB33C7779FA8A2100E9715C0023E595D760D6C9A6695A6A085CCD8F22712575ABE74A01C1A05400F56D4B61E8A83B75596B2688A2D6EBCA22AAF4ED3EE0E4356978251B99333FE224730FD8371A34919DAD073E46C6E503470394D60FDFC7C11FC62B87FAC8AB93456B139D49F9DA6E77B3DF4CACEB0C1F9B3FE2CD466354FC3B8CB2923C1F8F12505159210A7796535F692B886531701530C6F9AF84
answer = BA0D89B592F0495980B476E46BDF657D077071602F630EFC18D83F590818FE24F66F017A03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100232939B8A5969CA74982302C5B03AC4A9F14E18E0D75EC871CEACDF00B02BE7D1892EAC44715DA81D27D1D6EFAE52DEB320BB4D09B126E1E560BC672E0DB586F1D6ED0B7374595F1B53E0EDDC9F5C33C79F673BE0511A5839A2791AF995D18FE10BCA1274A28E8CF147287D4F38A3C4BB33C7779FA8A2100E9715C0023E595D760D6C9A6695A6A085CCD8F22712575ABE74A01C1A05400F56D4B61E8A83B75596B2688A2D6EBCA22AAF4ED3EE0E4356978251B99333FE224730FD8371A34919DAD073E46C6E503470394D60FDFC7C11FC62B87FAC8AB93456B139D49F9DA6E77B3DF4CACEB0C1F9B3FE2CD466354FC3B8CB2923C1F8F12505159210A7796535F692B886531701530C6F9AF84</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 92 F0 49 59 80 B4 76 E4 6B DF 65 7D
0010 | 07 70 71 60 2F 63 0E FC 18 D8 3F 59 08 18 FE 24
0020 | F6 6F 01 7A 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 23 29 39 B8 A5 96 9C A7 49 82 30 2C 5B 03 AC 4A
0140 | 9F 14 E1 8E 0D 75 EC 87 1C EA CD F0 0B 02 BE 7D
0150 | 18 92 EA C4 47 15 DA 81 D2 7D 1D 6E FA E5 2D EB
0160 | 32 0B B4 D0 9B 12 6E 1E 56 0B C6 72 E0 DB 58 6F
0170 | 1D 6E D0 B7 37 45 95 F1 B5 3E 0E DD C9 F5 C3 3C
0180 | 79 F6 73 BE 05 11 A5 83 9A 27 91 AF 99 5D 18 FE
0190 | 10 BC A1 27 4A 28 E8 CF 14 72 87 D4 F3 8A 3C 4B
01A0 | B3 3C 77 79 FA 8A 21 00 E9 71 5C 00 23 E5 95 D7
01B0 | 60 D6 C9 A6 69 5A 6A 08 5C CD 8F 22 71 25 75 AB
01C0 | E7 4A 01 C1 A0 54 00 F5 6D 4B 61 E8 A8 3B 75 59
01D0 | 6B 26 88 A2 D6 EB CA 22 AA F4 ED 3E E0 E4 35 69
01E0 | 78 25 1B 99 33 3F E2 24 73 0F D8 37 1A 34 91 9D
01F0 | AD 07 3E 46 C6 E5 03 47 03 94 D6 0F DF C7 C1 1F
0200 | C6 2B 87 FA C8 AB 93 45 6B 13 9D 49 F9 DA 6E 77
0210 | B3 DF 4C AC EB 0C 1F 9B 3F E2 CD 46 63 54 FC 3B
0220 | 8C B2 92 3C 1F 8F 12 50 51 59 21 0A 77 96 53 5F
0230 | 69 2B 88 65</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100232939B8A5969CA74982302C</code> <code>5B03AC4A9F14E18E0D75EC871CEACDF0</code> <code>0B02BE7D1892EAC44715DA81D27D1D6E</code> <code>FAE52DEB320BB4D09B126E1E560BC672</code> <code>E0DB586F1D6ED0B7374595F1B53E0EDD</code> <code>C9F5C33C79F673BE0511A5839A2791AF</code> <code>995D18FE10BCA1274A28E8CF147287D4</code> <code>F38A3C4BB33C7779FA8A2100E9715C00</code> <code>23E595D760D6C9A6695A6A085CCD8F22</code> <code>712575ABE74A01C1A05400F56D4B61E8</code> <code>A83B75596B2688A2D6EBCA22AAF4ED3E</code> <code>E0E4356978251B99333FE224730FD837</code> <code>1A34919DAD073E46C6E503470394D60F</code> <code>DFC7C11FC62B87FAC8AB93456B139D49</code> <code>F9DA6E77B3DF4CACEB0C1F9B3FE2CD46</code> <code>6354FC3B8CB2923C1F8F12505159210A</code><br> <code>7796535F</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>692B8865</code> (1703422825 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 8AB50D0843BF6FA3B20AB89B66D9A96ACF8C118F9595F81C31FAE3136CF59B0687CD98C1FDC764B1EAB24EB2E21AA84934CFA7456E4D562F85ED13EDFF1E039B43B2452B2960269A7B71FED89FF43BD10CD4043887725A91D10FE241769107A4E479E24FE880D87D0CB88CD4A413E48A9AADCBFE905483C95152B5BA0CB1918B9BC448F4A06F82BAFDD48E19B5772F5BA7D7FE7BAFB9DE526225E67B91CB5FED49F9EE469A5DA90300D3626442DBD5040E697735983BE9E688A5E3B7DEC349A45CCCA1FC6EFC1E867B204B562EEB1742826C487F9966463E452DA067AC11C68905B6730E5C00451DD3B7BCF77ADEE61E504708CF16BA755E1D0DEF02D1B32C33</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = B466195E80BDA27A26984FD61F37C70104ED1014482068434D5DA41DCC313A5FAC36FCD07DC07855611F104BB90C12818432CB3FEA1A9CA13400ED17F1D9CCC0C75E0337155FD42C677DFFB2439C58F5781DCD8C25A11EB474C6F9B350FD206379D29199784FB1CCA1404C2864187CB613F14B7229294B42619091CFB6160FDC8D05F25445646710A6D498CB00360C81250D1AAD71F25DE845B0F1BF51266C910976FF27D87D310258274A576C407D685B839E0F0BFC56F22135BF43B2949253FE7F927D7B967D7CCA0E18CFB30F6B98EFF384D3DA572A38BFEF2664F4EA3912E7AF6C98FDD10AB15F58263794A62938CB184BF9365CBE2D80D38AB8BC2F54DD</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 92 F0 49 59 80 B4 76 E4 6B DF 65 7D
0010 | 07 70 71 60 2F 63 0E FC 18 D8 3F 59 08 18 FE 24
0020 | F6 6F 01 7A 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | B4 66 19 5E 80 BD A2 7A 26 98 4F D6 1F 37 C7 01
0040 | 04 ED 10 14 48 20 68 43 4D 5D A4 1D CC 31 3A 5F
0050 | AC 36 FC D0 7D C0 78 55 61 1F 10 4B B9 0C 12 81
0060 | 84 32 CB 3F EA 1A 9C A1 34 00 ED 17 F1 D9 CC C0
0070 | C7 5E 03 37 15 5F D4 2C 67 7D FF B2 43 9C 58 F5
0080 | 78 1D CD 8C 25 A1 1E B4 74 C6 F9 B3 50 FD 20 63
0090 | 79 D2 91 99 78 4F B1 CC A1 40 4C 28 64 18 7C B6
00A0 | 13 F1 4B 72 29 29 4B 42 61 90 91 CF B6 16 0F DC
00B0 | 8D 05 F2 54 45 64 67 10 A6 D4 98 CB 00 36 0C 81
00C0 | 25 0D 1A AD 71 F2 5D E8 45 B0 F1 BF 51 26 6C 91
00D0 | 09 76 FF 27 D8 7D 31 02 58 27 4A 57 6C 40 7D 68
00E0 | 5B 83 9E 0F 0B FC 56 F2 21 35 BF 43 B2 94 92 53
00F0 | FE 7F 92 7D 7B 96 7D 7C CA 0E 18 CF B3 0F 6B 98
0100 | EF F3 84 D3 DA 57 2A 38 BF EF 26 64 F4 EA 39 12
0110 | E7 AF 6C 98 FD D1 0A B1 5F 58 26 37 94 A6 29 38
0120 | CB 18 4B F9 36 5C BE 2D 80 D3 8A B8 BC 2F 54 DD</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100B466195E80BDA27A26984FD6</code> <code>1F37C70104ED1014482068434D5DA41D</code> <code>CC313A5FAC36FCD07DC07855611F104B</code> <code>B90C12818432CB3FEA1A9CA13400ED17</code> <code>F1D9CCC0C75E0337155FD42C677DFFB2</code> <code>439C58F5781DCD8C25A11EB474C6F9B3</code> <code>50FD206379D29199784FB1CCA1404C28</code> <code>64187CB613F14B7229294B42619091CF</code> <code>B6160FDC8D05F25445646710A6D498CB</code> <code>00360C81250D1AAD71F25DE845B0F1BF</code> <code>51266C910976FF27D87D310258274A57</code> <code>6C407D685B839E0F0BFC56F22135BF43</code> <code>B2949253FE7F927D7B967D7CCA0E18CF</code> <code>B30F6B98EFF384D3DA572A38BFEF2664</code> <code>F4EA3912E7AF6C98FDD10AB15F582637</code> <code>94A62938CB184BF9365CBE2D80D38AB8</code><br> <code>BC2F54DD</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B6436692F0495980B476E46BDF657D077071602F630EFC18D83F590818FE24F66F017A0000000000000000FE000100B466195E80BDA27A26984FD61F37C70104ED1014482068434D5DA41DCC313A5FAC36FCD07DC07855611F104BB90C12818432CB3FEA1A9CA13400ED17F1D9CCC0C75E0337155FD42C677DFFB2439C58F5781DCD8C25A11EB474C6F9B350FD206379D29199784FB1CCA1404C2864187CB613F14B7229294B42619091CFB6160FDC8D05F25445646710A6D498CB00360C81250D1AAD71F25DE845B0F1BF51266C910976FF27D87D310258274A576C407D685B839E0F0BFC56F22135BF43B2949253FE7F927D7B967D7CCA0E18CFB30F6B98EFF384D3DA572A38BFEF2664F4EA3912E7AF6C98FDD10AB15F58263794A62938CB184BF9365CBE2D80D38AB8BC2F54DD
padding = 8CD71C42C31884520DEFD6DB
tmp_aes_key = 3A2455F86992C73BB43A2A7A7397E18CD56E1756616A3CBF4F601F32E08176B7
tmp_aes_iv = EBE760B2B410B8ADE48EC7F9702FF9B9E76D9E5C4C18FD3ACE47DF2A890BEAEA</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 6A85518F682E9B22FC69D96C945BF8AF75AE0078600F14C4D7CB19E5699744F8BA3652151CAFFCEC52C7AEBE0E651D73ECC52151463357E991C71B733BF82C8ECA9FCDD7CE98ED540C9B4C5A14B31FF9E1BCAB6A0167F03316AAF5252F3038CDAFF7ED55B0B827DD8DF15C9CA5ABA43001196C889928EA3C2A8DDA17AA6BD6043B3CB72B19D8C70B22C03437237003D90A372FA6EF7E63A48D965345686F4828BE5504B1A7BE126AEE30A981C94EE25ABD35285271BA0708A7F27E7E9F9C5300E627D1915EDA2AA91979B78C84DA24EB26EEBFC345EE7AC7CDBEB1E5A60E095745341EAADB809E4C38B3551E0AB066DDFED64345F28037648A4F38078D1C491E9E40DCEAB280D86B4532656FAADB1C06573332EEBBA573A0A9DB98C1F9CE301D6A9FEAE3B2476B432454E9C005823283F710F21DFEA3A5151D3404A5D007E45C985FA12B89B7CF1C8BD80437DC000279</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 F4 34 0A 00 69 2B 88 65
0010 | 78 01 00 00 1F 5F 04 F5 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60 2F 63 0E FC 18 D8 3F 59
0030 | 08 18 FE 24 F6 6F 01 7A FE 50 01 00 6A 85 51 8F
0040 | 68 2E 9B 22 FC 69 D9 6C 94 5B F8 AF 75 AE 00 78
0050 | 60 0F 14 C4 D7 CB 19 E5 69 97 44 F8 BA 36 52 15
0060 | 1C AF FC EC 52 C7 AE BE 0E 65 1D 73 EC C5 21 51
0070 | 46 33 57 E9 91 C7 1B 73 3B F8 2C 8E CA 9F CD D7
0080 | CE 98 ED 54 0C 9B 4C 5A 14 B3 1F F9 E1 BC AB 6A
0090 | 01 67 F0 33 16 AA F5 25 2F 30 38 CD AF F7 ED 55
00A0 | B0 B8 27 DD 8D F1 5C 9C A5 AB A4 30 01 19 6C 88
00B0 | 99 28 EA 3C 2A 8D DA 17 AA 6B D6 04 3B 3C B7 2B
00C0 | 19 D8 C7 0B 22 C0 34 37 23 70 03 D9 0A 37 2F A6
00D0 | EF 7E 63 A4 8D 96 53 45 68 6F 48 28 BE 55 04 B1
00E0 | A7 BE 12 6A EE 30 A9 81 C9 4E E2 5A BD 35 28 52
00F0 | 71 BA 07 08 A7 F2 7E 7E 9F 9C 53 00 E6 27 D1 91
0100 | 5E DA 2A A9 19 79 B7 8C 84 DA 24 EB 26 EE BF C3
0110 | 45 EE 7A C7 CD BE B1 E5 A6 0E 09 57 45 34 1E AA
0120 | DB 80 9E 4C 38 B3 55 1E 0A B0 66 DD FE D6 43 45
0130 | F2 80 37 64 8A 4F 38 07 8D 1C 49 1E 9E 40 DC EA
0140 | B2 80 D8 6B 45 32 65 6F AA DB 1C 06 57 33 32 EE
0150 | BB A5 73 A0 A9 DB 98 C1 F9 CE 30 1D 6A 9F EA E3
0160 | B2 47 6B 43 24 54 E9 C0 05 82 32 83 F7 10 F2 1D
0170 | FE A3 A5 15 1D 34 04 A5 D0 07 E4 5C 98 5F A1 2B
0180 | 89 B7 CF 1C 8B D8 04 37 DC 00 02 79</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>F4340A00692B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001006A85518F682E9B22FC69D96C</code> <code>945BF8AF75AE0078600F14C4D7CB19E5</code> <code>699744F8BA3652151CAFFCEC52C7AEBE</code> <code>0E651D73ECC52151463357E991C71B73</code> <code>3BF82C8ECA9FCDD7CE98ED540C9B4C5A</code> <code>14B31FF9E1BCAB6A0167F03316AAF525</code> <code>2F3038CDAFF7ED55B0B827DD8DF15C9C</code> <code>A5ABA43001196C889928EA3C2A8DDA17</code> <code>AA6BD6043B3CB72B19D8C70B22C03437</code> <code>237003D90A372FA6EF7E63A48D965345</code> <code>686F4828BE5504B1A7BE126AEE30A981</code> <code>C94EE25ABD35285271BA0708A7F27E7E</code> <code>9F9C5300E627D1915EDA2AA91979B78C</code> <code>84DA24EB26EEBFC345EE7AC7CDBEB1E5</code> <code>A60E095745341EAADB809E4C38B3551E</code> <code>0AB066DDFED64345F28037648A4F3807</code> <code>8D1C491E9E40DCEAB280D86B4532656F</code> <code>AADB1C06573332EEBBA573A0A9DB98C1</code> <code>F9CE301D6A9FEAE3B2476B432454E9C0</code> <code>05823283F710F21DFEA3A5151D3404A5</code> <code>D007E45C985FA12B89B7CF1C8BD80437</code><br> <code>DC000279</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = B2CE93368B11A779FE0440FCA53E14CB828D362BB785BC143189BFEA6568C3984B849E539520AADFDC707D757EAD1D484F9E21DB23C401B24DAEB77BCD24393119AFBB76A3565A8524FEBB8826A19FA9F3C8AA6DE9CD3E61ACCC67397F15DEAF85485E65A91DDFF0B42AB0A116CA1836B29AB202C4BB23EB4D3CD83A9E9AF768195EA5896A2E45BF57B39BDF100AA65A48E1ED45C94075AB0ED92C382BB6E3FC1EF0C86A0014E7271B84D0EC0C81A7410015760BE32D8AF026AB7C317A8B7103E178983A16B8E29B0C36B034595C733A5101E0B1A38ACC4D884089483C0FAB3815325604C679B865DB93759F05BAC1E74F37E3E300DE8FA39189FE898DC53B40</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 48 20 23 6A 2B 88 65
0010 | 7C 00 00 00 34 F7 CB 3B 92 F0 49 59 80 B4 76 E4
0020 | 6B DF 65 7D 07 70 71 60 2F 63 0E FC 18 D8 3F 59
0030 | 08 18 FE 24 F6 6F 01 7A F0 68 88 B1 E3 27 FC B7
0040 | 41 9B 90 89 C4 4B AF BF</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>014820236A2B8865</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>7C000000</code> (124 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>92F0495980B476E46BDF657D07707160</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>2F630EFC18D83F590818FE24F66F017A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>F06888B1E327FCB7419B9089C44BAFBF</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

