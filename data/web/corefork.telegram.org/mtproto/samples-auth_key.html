<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?236" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 54 F3 0C 00 47 E1 53 65
0010 | 14 00 00 00 F1 8E 7E BE C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>54F30C0047E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 EC 08 F5 47 E1 53 65
0010 | 98 00 00 00 63 24 16 05 C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6 AE 0B D3 44 AD A9 1E A2
0030 | E6 CF DD 57 46 53 37 E4 08 22 B7 00 AC DB 1A 68
0040 | 0B 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01EC08F547E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>98000000</code> (152 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>0822B700ACDB1A680B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2501468860437915659</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p--q" id="3-client-decomposes-pq-into-prime-factors-such-that-p--q" name="3-client-decomposes-pq-into-prime-factors-such-that-p--q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2501468860437915659</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2501468860437915659 = 1290516503 * 1938347053</code></p>
<pre><code>p = 1290516503
q = 1938347053</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 22 B7 00 AC DB 1A 68 0B 00 00 00
0010 | 04 4C EB B8 17 00 00 00 04 73 88 D4 2D 00 00 00
0020 | C1 14 9F E5 F9 AE 1D E6 F9 70 7B F1 87 27 3F E6
0030 | AE 0B D3 44 AD A9 1E A2 E6 CF DD 57 46 53 37 E4
0040 | 81 ED 7C DB 88 87 9E F6 36 F2 3A F4 28 35 1A 58
0050 | 4C 01 28 2A B6 BC E8 DE 66 B8 1A 9A A8 9A D0 3F
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>0822B700ACDB1A680B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2501468860437915659</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>044CEBB817000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1290516503</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>047388D42D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1938347053</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>81ED7CDB88879EF636F23AF428351A58</code> <code>4C01282AB6BCE8DE66B81A9AA89AD03F</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A90822B700ACDB1A680B000000044CEBB817000000047388D42D000000C1149FE5F9AE1DE6F9707BF187273FE6AE0BD344ADA91EA2E6CFDD57465337E481ED7CDB88879EF636F23AF428351A584C01282AB6BCE8DE66B81A9AA89AD03F02000000
random_padding_bytes = 8CF8CE4E191AF022190ECD0D6D03F2CA22AB992DAE5289644A79084907E66BE4964E608E2AFD37C358466313DCD99347BBF0A5D4DBBF3947A8FBC38CA3E26634206E073776AB164067EE3D8CAFBB3965A9D0CAE2473749727132EA6F</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 5D827F84130191D774B0646DBA7A0122D4EA18D1E83606E00629767D2DAE50E77EE357CD081C675CD29E42139D033024F0E04AF7911FB43C93FDBB2578AAB5DB345FF08657C8D693B404A11E2C985C7B289F036F2C260B0C2DA8C6FFD649AFD52A4BEACCEBC232590F75285222CA8A26A3574CEB122D77C645B43D88DE64474B0CC06162539D8D1334CA34B3325B70AC5F361D34EDAE3737005FD248E354EEE9860BBCB24E0476F99543B363584AAC31A0C95C4763C103DC42D2D09DBA540591D988EB6DFD3D3D84CBFACFBF29E63FE95F7F4CDCFDC4F934F131446CA25B4F76C1F589121E814208E1DAC2DA74CA44EA0124E22CC3752508706ABFAFE85B6921</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 D8 6C 04 00 48 E1 53 65
0010 | 40 01 00 00 BE E4 12 D7 C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6 AE 0B D3 44 AD A9 1E A2
0030 | E6 CF DD 57 46 53 37 E4 04 4C EB B8 17 00 00 00
0040 | 04 73 88 D4 2D 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 5D 82 7F 84 13 01 91 D7 74 B0 64 6D
0060 | BA 7A 01 22 D4 EA 18 D1 E8 36 06 E0 06 29 76 7D
0070 | 2D AE 50 E7 7E E3 57 CD 08 1C 67 5C D2 9E 42 13
0080 | 9D 03 30 24 F0 E0 4A F7 91 1F B4 3C 93 FD BB 25
0090 | 78 AA B5 DB 34 5F F0 86 57 C8 D6 93 B4 04 A1 1E
00A0 | 2C 98 5C 7B 28 9F 03 6F 2C 26 0B 0C 2D A8 C6 FF
00B0 | D6 49 AF D5 2A 4B EA CC EB C2 32 59 0F 75 28 52
00C0 | 22 CA 8A 26 A3 57 4C EB 12 2D 77 C6 45 B4 3D 88
00D0 | DE 64 47 4B 0C C0 61 62 53 9D 8D 13 34 CA 34 B3
00E0 | 32 5B 70 AC 5F 36 1D 34 ED AE 37 37 00 5F D2 48
00F0 | E3 54 EE E9 86 0B BC B2 4E 04 76 F9 95 43 B3 63
0100 | 58 4A AC 31 A0 C9 5C 47 63 C1 03 DC 42 D2 D0 9D
0110 | BA 54 05 91 D9 88 EB 6D FD 3D 3D 84 CB FA CF BF
0120 | 29 E6 3F E9 5F 7F 4C DC FD C4 F9 34 F1 31 44 6C
0130 | A2 5B 4F 76 C1 F5 89 12 1E 81 42 08 E1 DA C2 DA
0140 | 74 CA 44 EA 01 24 E2 2C C3 75 25 08 70 6A BF AF
0150 | E8 5B 69 21</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>D86C040048E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>044CEBB817000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1290516503</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>047388D42D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1938347053</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE0001005D827F84130191D774B0646D</code> <code>BA7A0122D4EA18D1E83606E00629767D</code> <code>2DAE50E77EE357CD081C675CD29E4213</code> <code>9D033024F0E04AF7911FB43C93FDBB25</code> <code>78AAB5DB345FF08657C8D693B404A11E</code> <code>2C985C7B289F036F2C260B0C2DA8C6FF</code> <code>D649AFD52A4BEACCEBC232590F752852</code> <code>22CA8A26A3574CEB122D77C645B43D88</code> <code>DE64474B0CC06162539D8D1334CA34B3</code> <code>325B70AC5F361D34EDAE3737005FD248</code> <code>E354EEE9860BBCB24E0476F99543B363</code> <code>584AAC31A0C95C4763C103DC42D2D09D</code> <code>BA540591D988EB6DFD3D3D84CBFACFBF</code> <code>29E63FE95F7F4CDCFDC4F934F131446C</code> <code>A25B4F76C1F589121E814208E1DAC2DA</code> <code>74CA44EA0124E22CC3752508706ABFAF</code><br> <code>E85B6921</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 60 9B 86 48 E1 53 65
0010 | 78 02 00 00 5C 07 E8 D0 C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6 AE 0B D3 44 AD A9 1E A2
0030 | E6 CF DD 57 46 53 37 E4 FE 50 02 00 CE 79 5D 8E
0040 | 47 ED A0 6D 17 94 24 36 D0 80 9E ED 52 EA D1 4E
0050 | 51 1D 35 A2 D6 D7 4C 17 4F E4 E4 42 9A ED DE B8
0060 | FD 86 3C 6C 4F D2 7B 64 BA C8 13 8E 79 46 0F 1E
0070 | 8D F1 5E D0 0A BA B4 08 D6 CD D6 61 AF A6 21 22
0080 | 2A 42 C9 00 0E 37 BA E2 DA 68 06 37 D9 03 D3 65
0090 | 37 77 78 6C 56 57 40 27 00 E6 6F A7 2B 69 C6 EB
00A0 | F1 6B E1 B8 30 AB 37 1C 7E 29 CA 0C 61 A8 A5 E4
00B0 | 78 4A FD 8E 15 F3 E7 86 1F 80 4C CB E0 6B 6F 65
00C0 | 1D 7C 17 6D 16 E2 2E 48 1D C4 08 56 7B DC 2F A9
00D0 | 3B 79 D8 9D D4 40 AD 63 CD 28 1C 1F A5 C7 9A DE
00E0 | 75 02 24 F8 94 2D D2 92 A0 AF DF FC 7C 09 CC BE
00F0 | EA 92 03 E6 F1 12 7D 8C B6 13 DB D1 C0 53 4E 31
0100 | 7F 14 A9 02 75 0D 27 51 FC E4 36 D7 18 70 F6 4D
0110 | 69 51 E2 EB 25 84 CC 81 D3 33 09 7F 89 21 69 31
0120 | B9 44 B7 DE 19 92 13 4D 4E 67 D5 9F CE F8 96 74
0130 | 6A A7 1D 09 94 D2 43 05 14 C3 5E 50 56 C7 69 C1
0140 | BE 4F 77 BD E9 9E B3 AC 4F 0E E6 15 56 60 F9 02
0150 | 54 64 7E DF D7 0B 8E 05 67 42 CC D5 FF 0B F1 AF
0160 | 0A 8F B5 91 D3 99 01 A6 C7 87 E0 48 2C 94 81 A0
0170 | 19 0D DF E0 AB 87 49 CD 0B E9 6D 0D D9 48 C6 F4
0180 | 33 D6 86 D7 41 3F 9C 25 51 AB 56 77 9D DE 4A 88
0190 | 86 B3 DB 82 25 76 E8 F3 D0 9F 18 EF 95 45 1A 53
01A0 | 09 7C 60 41 2A 07 26 87 C5 60 76 10 AA 44 E6 1F
01B0 | 72 D6 CE 47 4C 8B A7 CE A0 22 4A 2D DB D5 16 08
01C0 | D3 6D 17 5D C2 1A 5C A4 53 F1 AA 73 64 BF 47 10
01D0 | 71 9B 2E E9 B8 A5 13 E3 10 94 67 7A BC B2 8F 47
01E0 | C5 23 1D 3E 26 34 8E 98 4C BB FC EC A0 F8 C2 ED
01F0 | 8A 77 A2 2D 77 06 68 E8 9D E3 64 B0 0F 1F 13 83
0200 | F7 1C 8C 84 3D 45 2E F6 E5 C7 1D C3 4D 13 37 E5
0210 | A5 78 75 72 0C 8C E8 7E 94 C0 2D AF 42 97 D0 B3
0220 | C9 7C 21 70 97 5E F1 EB BE E0 59 65 61 9A 51 6D
0230 | 78 5F 3F EA 37 26 D0 46 35 E9 E4 2A 98 2E 75 26
0240 | 61 AC 7E B0 44 49 90 5A FA BA B5 E7 7B 34 09 CA
0250 | BE 19 9B B0 75 43 A0 89 56 EF 4C F8 1F 43 7D 00
0260 | DA 91 27 F2 80 AB DF 09 22 8B EB 66 B1 83 1D 75
0270 | 2A 90 13 C5 98 7B 4B 2F 46 DB B3 8D FD 5C C0 80
0280 | 1E D5 D1 5A 67 87 84 A5 04 07 D0 F0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01609B8648E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200CE795D8E47EDA06D17942436</code> <code>D0809EED52EAD14E511D35A2D6D74C17</code> <code>4FE4E4429AEDDEB8FD863C6C4FD27B64</code> <code>BAC8138E79460F1E8DF15ED00ABAB408</code> <code>D6CDD661AFA621222A42C9000E37BAE2</code> <code>DA680637D903D3653777786C56574027</code> <code>00E66FA72B69C6EBF16BE1B830AB371C</code> <code>7E29CA0C61A8A5E4784AFD8E15F3E786</code> <code>1F804CCBE06B6F651D7C176D16E22E48</code> <code>1DC408567BDC2FA93B79D89DD440AD63</code> <code>CD281C1FA5C79ADE750224F8942DD292</code> <code>A0AFDFFC7C09CCBEEA9203E6F1127D8C</code> <code>B613DBD1C0534E317F14A902750D2751</code> <code>FCE436D71870F64D6951E2EB2584CC81</code> <code>D333097F89216931B944B7DE1992134D</code> <code>4E67D59FCEF896746AA71D0994D24305</code> <code>14C35E5056C769C1BE4F77BDE99EB3AC</code> <code>4F0EE6155660F90254647EDFD70B8E05</code> <code>6742CCD5FF0BF1AF0A8FB591D39901A6</code> <code>C787E0482C9481A0190DDFE0AB8749CD</code> <code>0BE96D0DD948C6F433D686D7413F9C25</code> <code>51AB56779DDE4A8886B3DB822576E8F3</code> <code>D09F18EF95451A53097C60412A072687</code> <code>C5607610AA44E61F72D6CE474C8BA7CE</code> <code>A0224A2DDBD51608D36D175DC21A5CA4</code> <code>53F1AA7364BF4710719B2EE9B8A513E3</code> <code>1094677ABCB28F47C5231D3E26348E98</code> <code>4CBBFCECA0F8C2ED8A77A22D770668E8</code> <code>9DE364B00F1F1383F71C8C843D452EF6</code> <code>E5C71DC34D1337E5A57875720C8CE87E</code> <code>94C02DAF4297D0B3C97C2170975EF1EB</code> <code>BEE05965619A516D785F3FEA3726D046</code> <code>35E9E42A982E752661AC7EB04449905A</code> <code>FABAB5E77B3409CABE199BB07543A089</code> <code>56EF4CF81F437D00DA9127F280ABDF09</code> <code>228BEB66B1831D752A9013C5987B4B2F</code> <code>46DBB38DFD5CC0801ED5D15A678784A5</code><br> <code>0407D0F0</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = CE795D8E47EDA06D17942436D0809EED52EAD14E511D35A2D6D74C174FE4E4429AEDDEB8FD863C6C4FD27B64BAC8138E79460F1E8DF15ED00ABAB408D6CDD661AFA621222A42C9000E37BAE2DA680637D903D3653777786C5657402700E66FA72B69C6EBF16BE1B830AB371C7E29CA0C61A8A5E4784AFD8E15F3E7861F804CCBE06B6F651D7C176D16E22E481DC408567BDC2FA93B79D89DD440AD63CD281C1FA5C79ADE750224F8942DD292A0AFDFFC7C09CCBEEA9203E6F1127D8CB613DBD1C0534E317F14A902750D2751FCE436D71870F64D6951E2EB2584CC81D333097F89216931B944B7DE1992134D4E67D59FCEF896746AA71D0994D2430514C35E5056C769C1BE4F77BDE99EB3AC4F0EE6155660F90254647EDFD70B8E056742CCD5FF0BF1AF0A8FB591D39901A6C787E0482C9481A0190DDFE0AB8749CD0BE96D0DD948C6F433D686D7413F9C2551AB56779DDE4A8886B3DB822576E8F3D09F18EF95451A53097C60412A072687C5607610AA44E61F72D6CE474C8BA7CEA0224A2DDBD51608D36D175DC21A5CA453F1AA7364BF4710719B2EE9B8A513E31094677ABCB28F47C5231D3E26348E984CBBFCECA0F8C2ED8A77A22D770668E89DE364B00F1F1383F71C8C843D452EF6E5C71DC34D1337E5A57875720C8CE87E94C02DAF4297D0B3C97C2170975EF1EBBEE05965619A516D785F3FEA3726D04635E9E42A982E752661AC7EB04449905AFABAB5E77B3409CABE199BB07543A08956EF4CF81F437D00DA9127F280ABDF09228BEB66B1831D752A9013C5987B4B2F46DBB38DFD5CC0801ED5D15A678784A50407D0F0
tmp_aes_key = AAB528F14E8ECAD99290F5AC3CA8B323046841A628252C83652DDD78C02F4C8C
tmp_aes_iv = 87AC534B08733D154F4A15EF6B70605F622ED308764630B0C6DE2E4F81ED7CDB</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = D7D69FAB8E635139666E8D49D62B0FF05008FBADBA0D89B5C1149FE5F9AE1DE6F9707BF187273FE6AE0BD344ADA91EA2E6CFDD57465337E403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001004966BEB0A959683CE296167319A09A8A5B7F9C77245C9CF0B377BEFDAD9EB6FD23B87493E56D60C12B77F787B008B108AE4C0B25F47948D5258EB8E416DD489429296583DDB6BF8A82FB4245AAB880C94FB99FA869005D43C5F2E69208DF8DBAE15AF63B377EB732CA630B7C5713737EC472DEA4CDBD70E8E532692382843A3398A0C4300B54554C1770282A9FD8741DD88A0A0D94A29D64FE69A8F3FB9062B8F17E05A3FC64453778151D45484EFF2B220E8C741704029134CA0C1888DC62EE80801E5C0F0E4A1B6CB40938B7D701AA73CB9AD3737B1F01B064449F14E5B0FF2E44341722555FE60C4DCF3C229534804F872CF490ED922CDA61242A44CDC9D348E15365AA4A0B46C1AB881E
answer = BA0D89B5C1149FE5F9AE1DE6F9707BF187273FE6AE0BD344ADA91EA2E6CFDD57465337E403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001004966BEB0A959683CE296167319A09A8A5B7F9C77245C9CF0B377BEFDAD9EB6FD23B87493E56D60C12B77F787B008B108AE4C0B25F47948D5258EB8E416DD489429296583DDB6BF8A82FB4245AAB880C94FB99FA869005D43C5F2E69208DF8DBAE15AF63B377EB732CA630B7C5713737EC472DEA4CDBD70E8E532692382843A3398A0C4300B54554C1770282A9FD8741DD88A0A0D94A29D64FE69A8F3FB9062B8F17E05A3FC64453778151D45484EFF2B220E8C741704029134CA0C1888DC62EE80801E5C0F0E4A1B6CB40938B7D701AA73CB9AD3737B1F01B064449F14E5B0FF2E44341722555FE60C4DCF3C229534804F872CF490ED922CDA61242A44CDC9D348E15365AA4A0B46C1AB881E</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 C1 14 9F E5 F9 AE 1D E6 F9 70 7B F1
0010 | 87 27 3F E6 AE 0B D3 44 AD A9 1E A2 E6 CF DD 57
0020 | 46 53 37 E4 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 49 66 BE B0 A9 59 68 3C E2 96 16 73 19 A0 9A 8A
0140 | 5B 7F 9C 77 24 5C 9C F0 B3 77 BE FD AD 9E B6 FD
0150 | 23 B8 74 93 E5 6D 60 C1 2B 77 F7 87 B0 08 B1 08
0160 | AE 4C 0B 25 F4 79 48 D5 25 8E B8 E4 16 DD 48 94
0170 | 29 29 65 83 DD B6 BF 8A 82 FB 42 45 AA B8 80 C9
0180 | 4F B9 9F A8 69 00 5D 43 C5 F2 E6 92 08 DF 8D BA
0190 | E1 5A F6 3B 37 7E B7 32 CA 63 0B 7C 57 13 73 7E
01A0 | C4 72 DE A4 CD BD 70 E8 E5 32 69 23 82 84 3A 33
01B0 | 98 A0 C4 30 0B 54 55 4C 17 70 28 2A 9F D8 74 1D
01C0 | D8 8A 0A 0D 94 A2 9D 64 FE 69 A8 F3 FB 90 62 B8
01D0 | F1 7E 05 A3 FC 64 45 37 78 15 1D 45 48 4E FF 2B
01E0 | 22 0E 8C 74 17 04 02 91 34 CA 0C 18 88 DC 62 EE
01F0 | 80 80 1E 5C 0F 0E 4A 1B 6C B4 09 38 B7 D7 01 AA
0200 | 73 CB 9A D3 73 7B 1F 01 B0 64 44 9F 14 E5 B0 FF
0210 | 2E 44 34 17 22 55 5F E6 0C 4D CF 3C 22 95 34 80
0220 | 4F 87 2C F4 90 ED 92 2C DA 61 24 2A 44 CD C9 D3
0230 | 48 E1 53 65</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE0001004966BEB0A959683CE2961673</code> <code>19A09A8A5B7F9C77245C9CF0B377BEFD</code> <code>AD9EB6FD23B87493E56D60C12B77F787</code> <code>B008B108AE4C0B25F47948D5258EB8E4</code> <code>16DD489429296583DDB6BF8A82FB4245</code> <code>AAB880C94FB99FA869005D43C5F2E692</code> <code>08DF8DBAE15AF63B377EB732CA630B7C</code> <code>5713737EC472DEA4CDBD70E8E5326923</code> <code>82843A3398A0C4300B54554C1770282A</code> <code>9FD8741DD88A0A0D94A29D64FE69A8F3</code> <code>FB9062B8F17E05A3FC64453778151D45</code> <code>484EFF2B220E8C741704029134CA0C18</code> <code>88DC62EE80801E5C0F0E4A1B6CB40938</code> <code>B7D701AA73CB9AD3737B1F01B064449F</code> <code>14E5B0FF2E44341722555FE60C4DCF3C</code> <code>229534804F872CF490ED922CDA61242A</code><br> <code>44CDC9D3</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>48E15365</code> (1699995976 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = D983DD33FEB0575878CD78B06E0C60B17F0A85CC0BFFE09FD674DD8780375D9680AB34F285326193C8F82D4FB78E35DE6B822C38950E58D2671745D3F2E6FF699BE3275FA2E1F03B2C3908D2DF742D89B56C3303A2F01F0E80974379AF6EFDCD5F9A3F648D331E104D434BB1482D034F87CD5CDCE626479327F2E05B17E3FE6CC844F528BA4B6F28DFB965A09B6A6A5C050028B777FA4EBBC0582684754A3D0D626626FC1C0C3A082A362A2561B58C2AF9DA08119FAE985A3CBA321CCF21CB8D7048053FF8EC472819D5F4BB677B86D91F973BC1CF8C981A8E0FD80539A1FC76841C93793929529047EC817AEE8D7929372898D92EF452AC6E1D8DDA57EFB1DD</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 540F41842CFA15D55F55280D42038B546367D978B5308533451537E87064A529555821A506A7E3B4C124F31B5C98EA680B90CB897F01559AA8F016784A5317D6C1921BF8A4A8AF1A0F68C67BD255EC109D64F816993D3D5482C4757E2D23F7DB5D836BCF6BDDE20403F0C1DCA32C085F64E3567BB89688A2F8FCC60886CCD68106BCF51CED5CFF6B988CD25A1FFB447677262C1CADFBD3DF40DBA762902220514E3C937EF6852D6C92792DCAE36F32E9A398A659AB22AEF8FAA588DC3C2E4CA73017C175A6F1FCA75FBDC9B44594D73A4E02F37D4D3FAC8F1A919920D9C2AD644305D6BD6E421C1ED7B0B9C7EF0B06C04133530664F9C0CFD7C77C905BC44536</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 C1 14 9F E5 F9 AE 1D E6 F9 70 7B F1
0010 | 87 27 3F E6 AE 0B D3 44 AD A9 1E A2 E6 CF DD 57
0020 | 46 53 37 E4 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 54 0F 41 84 2C FA 15 D5 5F 55 28 0D 42 03 8B 54
0040 | 63 67 D9 78 B5 30 85 33 45 15 37 E8 70 64 A5 29
0050 | 55 58 21 A5 06 A7 E3 B4 C1 24 F3 1B 5C 98 EA 68
0060 | 0B 90 CB 89 7F 01 55 9A A8 F0 16 78 4A 53 17 D6
0070 | C1 92 1B F8 A4 A8 AF 1A 0F 68 C6 7B D2 55 EC 10
0080 | 9D 64 F8 16 99 3D 3D 54 82 C4 75 7E 2D 23 F7 DB
0090 | 5D 83 6B CF 6B DD E2 04 03 F0 C1 DC A3 2C 08 5F
00A0 | 64 E3 56 7B B8 96 88 A2 F8 FC C6 08 86 CC D6 81
00B0 | 06 BC F5 1C ED 5C FF 6B 98 8C D2 5A 1F FB 44 76
00C0 | 77 26 2C 1C AD FB D3 DF 40 DB A7 62 90 22 20 51
00D0 | 4E 3C 93 7E F6 85 2D 6C 92 79 2D CA E3 6F 32 E9
00E0 | A3 98 A6 59 AB 22 AE F8 FA A5 88 DC 3C 2E 4C A7
00F0 | 30 17 C1 75 A6 F1 FC A7 5F BD C9 B4 45 94 D7 3A
0100 | 4E 02 F3 7D 4D 3F AC 8F 1A 91 99 20 D9 C2 AD 64
0110 | 43 05 D6 BD 6E 42 1C 1E D7 B0 B9 C7 EF 0B 06 C0
0120 | 41 33 53 06 64 F9 C0 CF D7 C7 7C 90 5B C4 45 36</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100540F41842CFA15D55F55280D</code> <code>42038B546367D978B5308533451537E8</code> <code>7064A529555821A506A7E3B4C124F31B</code> <code>5C98EA680B90CB897F01559AA8F01678</code> <code>4A5317D6C1921BF8A4A8AF1A0F68C67B</code> <code>D255EC109D64F816993D3D5482C4757E</code> <code>2D23F7DB5D836BCF6BDDE20403F0C1DC</code> <code>A32C085F64E3567BB89688A2F8FCC608</code> <code>86CCD68106BCF51CED5CFF6B988CD25A</code> <code>1FFB447677262C1CADFBD3DF40DBA762</code> <code>902220514E3C937EF6852D6C92792DCA</code> <code>E36F32E9A398A659AB22AEF8FAA588DC</code> <code>3C2E4CA73017C175A6F1FCA75FBDC9B4</code> <code>4594D73A4E02F37D4D3FAC8F1A919920</code> <code>D9C2AD644305D6BD6E421C1ED7B0B9C7</code> <code>EF0B06C04133530664F9C0CFD7C77C90</code><br> <code>5BC44536</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366C1149FE5F9AE1DE6F9707BF187273FE6AE0BD344ADA91EA2E6CFDD57465337E40000000000000000FE000100540F41842CFA15D55F55280D42038B546367D978B5308533451537E87064A529555821A506A7E3B4C124F31B5C98EA680B90CB897F01559AA8F016784A5317D6C1921BF8A4A8AF1A0F68C67BD255EC109D64F816993D3D5482C4757E2D23F7DB5D836BCF6BDDE20403F0C1DCA32C085F64E3567BB89688A2F8FCC60886CCD68106BCF51CED5CFF6B988CD25A1FFB447677262C1CADFBD3DF40DBA762902220514E3C937EF6852D6C92792DCAE36F32E9A398A659AB22AEF8FAA588DC3C2E4CA73017C175A6F1FCA75FBDC9B44594D73A4E02F37D4D3FAC8F1A919920D9C2AD644305D6BD6E421C1ED7B0B9C7EF0B06C04133530664F9C0CFD7C77C905BC44536
padding = B94DF620FF1C81E31C1DB4B1
tmp_aes_key = AAB528F14E8ECAD99290F5AC3CA8B323046841A628252C83652DDD78C02F4C8C
tmp_aes_iv = 87AC534B08733D154F4A15EF6B70605F622ED308764630B0C6DE2E4F81ED7CDB</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 8754EE73F5E3BB3DC2AB18A45513DDD702754C66965FA712F2E3E87DC39E4554FDC8AB738A512601964247B45BFF72EB2C8C9907A24C0C4A74BB876602989F25BFF98B6A6665057048669B151642E77B36C7546EECB4AF944FCCD7281AA3543852FBC2DBCBB8392CCDBB0C436E5DB2097B912C5578367C498AA57BA8FBF9DE273646CD003488D43417FA1578EFC7253C991432400BA9F5A345669744EBD9D45CE1A14538CADE1375854EDF235B6DF8550CCCF387F250BFB457456AFA7BB435021B73D9583BB210242DA377C4E8875128D3A745CFCBDA7F79651879112788ECE2CF7238F091638250E3DC866D52F1BC648EA4C13AA42CC6CDE0796A7F90D7CED764A804C573271DE7070036ED7E8CFCFA38FC5B0EB113B6215E37E9A918AAC8BBB0E065C2A7C8D6C0912EFC9717327E0F299D2E19F8DBECE013FBAA41E6C7CD57A7661C0878CA6E712F84BA3E28867E2D</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 58 F3 06 00 49 E1 53 65
0010 | 78 01 00 00 1F 5F 04 F5 C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6 AE 0B D3 44 AD A9 1E A2
0030 | E6 CF DD 57 46 53 37 E4 FE 50 01 00 87 54 EE 73
0040 | F5 E3 BB 3D C2 AB 18 A4 55 13 DD D7 02 75 4C 66
0050 | 96 5F A7 12 F2 E3 E8 7D C3 9E 45 54 FD C8 AB 73
0060 | 8A 51 26 01 96 42 47 B4 5B FF 72 EB 2C 8C 99 07
0070 | A2 4C 0C 4A 74 BB 87 66 02 98 9F 25 BF F9 8B 6A
0080 | 66 65 05 70 48 66 9B 15 16 42 E7 7B 36 C7 54 6E
0090 | EC B4 AF 94 4F CC D7 28 1A A3 54 38 52 FB C2 DB
00A0 | CB B8 39 2C CD BB 0C 43 6E 5D B2 09 7B 91 2C 55
00B0 | 78 36 7C 49 8A A5 7B A8 FB F9 DE 27 36 46 CD 00
00C0 | 34 88 D4 34 17 FA 15 78 EF C7 25 3C 99 14 32 40
00D0 | 0B A9 F5 A3 45 66 97 44 EB D9 D4 5C E1 A1 45 38
00E0 | CA DE 13 75 85 4E DF 23 5B 6D F8 55 0C CC F3 87
00F0 | F2 50 BF B4 57 45 6A FA 7B B4 35 02 1B 73 D9 58
0100 | 3B B2 10 24 2D A3 77 C4 E8 87 51 28 D3 A7 45 CF
0110 | CB DA 7F 79 65 18 79 11 27 88 EC E2 CF 72 38 F0
0120 | 91 63 82 50 E3 DC 86 6D 52 F1 BC 64 8E A4 C1 3A
0130 | A4 2C C6 CD E0 79 6A 7F 90 D7 CE D7 64 A8 04 C5
0140 | 73 27 1D E7 07 00 36 ED 7E 8C FC FA 38 FC 5B 0E
0150 | B1 13 B6 21 5E 37 E9 A9 18 AA C8 BB B0 E0 65 C2
0160 | A7 C8 D6 C0 91 2E FC 97 17 32 7E 0F 29 9D 2E 19
0170 | F8 DB EC E0 13 FB AA 41 E6 C7 CD 57 A7 66 1C 08
0180 | 78 CA 6E 71 2F 84 BA 3E 28 86 7E 2D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>58F3060049E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001008754EE73F5E3BB3DC2AB18A4</code> <code>5513DDD702754C66965FA712F2E3E87D</code> <code>C39E4554FDC8AB738A512601964247B4</code> <code>5BFF72EB2C8C9907A24C0C4A74BB8766</code> <code>02989F25BFF98B6A6665057048669B15</code> <code>1642E77B36C7546EECB4AF944FCCD728</code> <code>1AA3543852FBC2DBCBB8392CCDBB0C43</code> <code>6E5DB2097B912C5578367C498AA57BA8</code> <code>FBF9DE273646CD003488D43417FA1578</code> <code>EFC7253C991432400BA9F5A345669744</code> <code>EBD9D45CE1A14538CADE1375854EDF23</code> <code>5B6DF8550CCCF387F250BFB457456AFA</code> <code>7BB435021B73D9583BB210242DA377C4</code> <code>E8875128D3A745CFCBDA7F7965187911</code> <code>2788ECE2CF7238F091638250E3DC866D</code> <code>52F1BC648EA4C13AA42CC6CDE0796A7F</code> <code>90D7CED764A804C573271DE7070036ED</code> <code>7E8CFCFA38FC5B0EB113B6215E37E9A9</code> <code>18AAC8BBB0E065C2A7C8D6C0912EFC97</code> <code>17327E0F299D2E19F8DBECE013FBAA41</code> <code>E6C7CD57A7661C0878CA6E712F84BA3E</code><br> <code>28867E2D</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 2515112E2E96F7875445D5392ECC5C0A6BD132BB670689F8E1A7868BD66098C71AB5E5ADE9837840E70C641FD8C6C6509D60D2444B570BE02429CA2FF4E71DC0DEBBEBDA8BEF55B4803138CA2252F67C7F0037A9BC527B09D04D6A92C537B48D4FC1FA6800A0F5B29B418A2837EEAED7F737CF5AFE5F30EE083D1128C0B07EB27192521DBE3A4DC7787AB9F6D5B97DEA3EDA83C2D6CEBAF7BDED24A2B3C86AFF6302910CC41D18E4CDD38B1E80A51390ED997A3636CA925940835DBD0EEA2C3591E4B070F22BC994802130DBAC1B1841BF8551B449A79CA44AFD0B802CA9CF1A1562E3A107164A6209893972B64370F0F8FDF6FB4B4A96EE2EB420CF4C268645</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 2C 10 51 49 E1 53 65
0010 | A0 00 00 00 34 F7 CB 3B C1 14 9F E5 F9 AE 1D E6
0020 | F9 70 7B F1 87 27 3F E6 AE 0B D3 44 AD A9 1E A2
0030 | E6 CF DD 57 46 53 37 E4 1C D4 E4 26 F1 55 06 E1
0040 | 5A 63 BB 3F D5 C1 AE 5A</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>012C105149E15365</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>A0000000</code> (160 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>C1149FE5F9AE1DE6F9707BF187273FE6</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>AE0BD344ADA91EA2E6CFDD57465337E4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>1CD4E426F15506E15A63BB3FD5C1AE5A</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

