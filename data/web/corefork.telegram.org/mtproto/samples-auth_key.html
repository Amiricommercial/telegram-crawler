<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>samples-auth_key</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="In the examples below, the transport headers are omitted:
For example, for the abridged version of the transport », the…">
    <meta property="og:title" content="samples-auth_key">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="In the examples below, the transport headers are omitted:
For example, for the abridged version of the transport », the…">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?236" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >samples-auth_key</a></li></ul></div>
  <h1 id="dev_page_title">samples-auth_key</h1>
  
  <div id="dev_page_content"><h1><a class="anchor" href="#" id="" name=""><i class="anchor-icon"></i></a></h1>
<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h1><a class="anchor" href="#1-request-req-pq-multi" id="1-request-req-pq-multi" name="1-request-req-pq-multi"><i class="anchor-icon"></i></a>1. request req_pq_multi</h1>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 00 00 00 13 90 9C 64
0010 | 14 00 00 00 F1 8E 7E BE A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0</code></pre>
<p>Payload serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0000000013909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h1><a class="anchor" href="#2-response-respq" id="2-response-respq" name="2-response-respq"><i class="anchor-icon"></i></a>2. response respq</h1>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 A8 D4 9C 13 90 9C 64
0010 | 78 00 00 00 63 24 16 05 A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F
0030 | 4C 26 45 7B 02 94 8D CA 08 28 6C A9 D9 90 2D A7
0040 | ED 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;long&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01A8D49C13909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78000000</code> (120 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>08286CA9D9902DA7ED000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2912889810893776877</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector long)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h1><a class="anchor" href="#21-decompose-p-and-q" id="21-decompose-p-and-q" name="21-decompose-p-and-q"><i class="anchor-icon"></i></a>2.1. decompose p and q</h1>
<!-- start pq -->
<pre><code>pq = 2912889810893776877</code></pre>
<p>Decompose into 2 prime cofactors: <code>1567638131 * 1858139167 = 2912889810893776877</code></p>
<pre><code>p = 1567638131
q = 1858139167</code></pre>
<!-- end pq -->
<h1><a class="anchor" href="#22-encrypted-data-generation" id="22-encrypted-data-generation" name="22-encrypted-data-generation"><i class="anchor-icon"></i></a>2.2. encrypted_data generation</h1>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 28 6C A9 D9 90 2D A7 ED 00 00 00
0010 | 04 5D 70 42 73 00 00 00 04 6E C0 F4 1F 00 00 00
0020 | A1 F9 B9 D5 B1 C7 24 55 20 11 1F B7 30 1C 95 C0
0030 | 70 EA 28 24 B9 2F 73 9F 4C 26 45 7B 02 94 8D CA
0040 | F6 CB F0 39 C5 6D 79 01 6C 22 33 6A C3 4A C3 CC
0050 | C6 CF 1F 11 32 3A CB FC CB 06 62 7E 94 BB C3 59
0060 | 02 00 00 00</code></pre>
<p>Payload serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;
p_q_inner_data_temp_dc#56fddf88 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int expires_in:int = P_Q_inner_data;
p_q_inner_data#83c95aec pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 = P_Q_inner_data;
p_q_inner_data_temp#3c6a84d4 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 expires_in:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>08286CA9D9902DA7ED000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2912889810893776877</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>045D704273000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1567638131</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046EC0F41F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1858139167</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>F6CBF039C56D79016C22336AC34AC3CC</code> <code>C6CF1F11323ACBFCCB06627E94BBC359</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A908286CA9D9902DA7ED000000045D704273000000046EC0F41F000000A1F9B9D5B1C7245520111FB7301C95C070EA2824B92F739F4C26457B02948DCAF6CBF039C56D79016C22336AC34AC3CCC6CF1F11323ACBFCCB06627E94BBC35902000000
random_padding_bytes = C00B71D54D522A134D231AEE7DD68B5290D97FA57F4C2A735C4A5FC2044F28D9C361D1E16F70C6A33477F27B5EF538D532398E3A34BE17192389F2C3F214F8F2A50C9646E1143EA5B5C421DE5A2F8A20FBDC3F3C08D706F13EDA3BB9</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = C576240305C4E62F0D4C1C7DA76D16A3F0529C38CC8AC087C3A098D44B4A6D96E0508217EEE987E092F079FE61ED02D73B513E612D1CA391D3DFF3AFEE0919B45A5E5F80677517543A2624E46E238564118311EABB002ECE73BAD010C1DAB49F422FF700351772C017721407B6058F684A65C271B618AD30B6FFAC6F27AA39F7425E6C20AB1B3F3CEF228863F88D0EE72409A5E737C928562CF4FCA9C2158FBD92991126735E7C0A036CE498C9675017C10137AB1D0584CB7D75975DE4F3D3746B8416ACDA103A753C0B249D0D29D0E0E81206B56BC583333DEABEA203D7E42A19680F4C3996E408E369D208533C2C6EE9D1574F3722BCD9EC15789EE285942A</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h1><a class="anchor" href="#3-request-req-dh-params" id="3-request-req-dh-params" name="3-request-req-dh-params"><i class="anchor-icon"></i></a>3. request req_dh_params</h1>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 04 00 00 00 13 90 9C 64
0010 | 40 01 00 00 BE E4 12 D7 A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F
0030 | 4C 26 45 7B 02 94 8D CA 04 5D 70 42 73 00 00 00
0040 | 04 6E C0 F4 1F 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 C5 76 24 03 05 C4 E6 2F 0D 4C 1C 7D
0060 | A7 6D 16 A3 F0 52 9C 38 CC 8A C0 87 C3 A0 98 D4
0070 | 4B 4A 6D 96 E0 50 82 17 EE E9 87 E0 92 F0 79 FE
0080 | 61 ED 02 D7 3B 51 3E 61 2D 1C A3 91 D3 DF F3 AF
0090 | EE 09 19 B4 5A 5E 5F 80 67 75 17 54 3A 26 24 E4
00A0 | 6E 23 85 64 11 83 11 EA BB 00 2E CE 73 BA D0 10
00B0 | C1 DA B4 9F 42 2F F7 00 35 17 72 C0 17 72 14 07
00C0 | B6 05 8F 68 4A 65 C2 71 B6 18 AD 30 B6 FF AC 6F
00D0 | 27 AA 39 F7 42 5E 6C 20 AB 1B 3F 3C EF 22 88 63
00E0 | F8 8D 0E E7 24 09 A5 E7 37 C9 28 56 2C F4 FC A9
00F0 | C2 15 8F BD 92 99 11 26 73 5E 7C 0A 03 6C E4 98
0100 | C9 67 50 17 C1 01 37 AB 1D 05 84 CB 7D 75 97 5D
0110 | E4 F3 D3 74 6B 84 16 AC DA 10 3A 75 3C 0B 24 9D
0120 | 0D 29 D0 E0 E8 12 06 B5 6B C5 83 33 3D EA BE A2
0130 | 03 D7 E4 2A 19 68 0F 4C 39 96 E4 08 E3 69 D2 08
0140 | 53 3C 2C 6E E9 D1 57 4F 37 22 BC D9 EC 15 78 9E
0150 | E2 85 94 2A</code></pre>
<p>Payload serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0400000013909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>045D704273000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1567638131</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046EC0F41F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1858139167</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100C576240305C4E62F0D4C1C7D</code> <code>A76D16A3F0529C38CC8AC087C3A098D4</code> <code>4B4A6D96E0508217EEE987E092F079FE</code> <code>61ED02D73B513E612D1CA391D3DFF3AF</code> <code>EE0919B45A5E5F80677517543A2624E4</code> <code>6E238564118311EABB002ECE73BAD010</code> <code>C1DAB49F422FF700351772C017721407</code> <code>B6058F684A65C271B618AD30B6FFAC6F</code> <code>27AA39F7425E6C20AB1B3F3CEF228863</code> <code>F88D0EE72409A5E737C928562CF4FCA9</code> <code>C2158FBD92991126735E7C0A036CE498</code> <code>C9675017C10137AB1D0584CB7D75975D</code> <code>E4F3D3746B8416ACDA103A753C0B249D</code> <code>0D29D0E0E81206B56BC583333DEABEA2</code> <code>03D7E42A19680F4C3996E408E369D208</code> <code>533C2C6EE9D1574F3722BCD9EC15789EE285942A</code></td>
<td>See <a href="#generation-of-encrypted-data">Generation of encrypted_data »</a></td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h1><a class="anchor" href="#4-response-server-dh-params-ok" id="4-response-server-dh-params-ok" name="4-response-server-dh-params-ok"><i class="anchor-icon"></i></a>4. response server_dh_params_ok</h1>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 C0 2E 41 14 90 9C 64
0010 | A0 02 00 00 5C 07 E8 D0 A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F
0030 | 4C 26 45 7B 02 94 8D CA FE 50 02 00 A3 7D DE 27
0040 | DD 2C D8 36 5E 53 A4 4D 45 8F AE C7 07 B8 4F FD
0050 | 0D 1D C6 0F 93 EB 8D EE 86 40 8C DE 4D 4A CC 01
0060 | DE F4 1C A8 F3 F5 53 0C A6 7C 07 C6 0F 80 B3 73
0070 | EB 00 95 4B BA 8D CA 2F EB CC 73 37 48 55 DC AC
0080 | E3 4A 58 4F 83 54 43 B1 4C F6 1B B8 D5 02 32 31
0090 | 5B 84 23 C4 86 09 B4 F9 43 00 AA 85 AC DD 37 AE
00A0 | 48 33 CF 72 62 FD 78 F9 E9 CF 55 91 CC B1 37 16
00B0 | 8C CB 51 C2 32 D0 99 3F B9 13 EB F3 84 28 BA 71
00C0 | 4C 7C 44 3B 54 34 BF F6 EB C2 64 9C D5 2B E1 0D
00D0 | 91 AF EB A2 9E 8F F1 CA E7 90 5E 05 25 04 50 E9
00E0 | D4 A8 2D 32 20 A9 4D E8 CE DA 2F 5B 30 E5 AA 1E
00F0 | E5 FD 30 B4 F8 41 1D 98 1B FD 73 22 65 08 01 49
0100 | 0E BC 4B 06 94 24 93 DB B2 E3 D6 1A EF 42 8E D9
0110 | 63 E1 69 6C 26 42 02 24 65 D2 E4 57 FD F9 70 FC
0120 | 54 A1 68 48 3B 26 E4 57 DA 08 A3 FA 17 BC 17 54
0130 | E6 03 CD F7 17 C6 37 C2 A4 71 6E 86 8E 98 DA 8C
0140 | EE 3C 11 34 62 0C 12 A0 A0 12 9F 13 6C D1 E1 F4
0150 | 4A C1 F6 E9 DB AB 69 A8 DE 5C 1E 98 12 04 95 5E
0160 | E6 D1 47 CF 12 2B C6 D9 69 3C CC 31 C8 46 2B 20
0170 | 51 23 08 52 5C 42 A2 44 4B 00 23 F3 1F 84 91 99
0180 | 21 11 D1 F7 0D 15 B0 60 BC 12 9A 98 C4 8B 1D 3C
0190 | F7 82 F0 80 8D 24 79 CA 42 16 4F FB 92 FD 2C 2D
01A0 | CF EB 56 E4 95 3E CB 49 68 29 E6 FF BA 59 FF F5
01B0 | D8 A6 6E 43 82 D3 AF 89 BC A5 14 38 34 EA 4B 2C
01C0 | 30 C7 DE 8D 65 A3 2F A6 39 0D 57 F7 D5 02 57 8F
01D0 | BA 76 16 20 0D 5B 2E 5B 12 A8 99 B8 EB 10 C9 EF
01E0 | 48 35 C3 B5 ED 95 42 7F 06 3F 0A FD 19 63 AD F6
01F0 | 5C BC 1F EC 55 CC 28 22 DD DE 4A 7E EB DC AD 6E
0200 | AB AD B0 CF 51 A3 D0 FA 5A 14 1B 31 BB E5 75 18
0210 | 7E 6D 7C CC 57 97 7D 2E 7D 86 AA 50 5F 10 F5 00
0220 | 34 58 63 75 DC F2 2B 9C 91 B5 B4 B0 11 51 97 1E
0230 | 20 E1 01 E3 54 18 DF 6C 1E 89 6C BC DF 61 77 FF
0240 | 90 03 B0 DF 21 75 F7 A4 DC 61 C6 FD 7A 76 54 AE
0250 | 50 4C DC A0 1A 22 31 4B 88 D5 4A 1B A4 D6 D4 90
0260 | AB FA 71 DA 42 89 3C D8 28 45 FE 55 DA C2 68 B2
0270 | 00 1D 2B 07 AF 47 B5 09 2F 2B 4A 7D FD D0 98 48
0280 | 0D 53 41 9D 52 DD 93 42 E6 E3 F7 E1</code></pre>
<p>Payload serialization:</p>
<pre><code>server_DH_params_fail#79cb045d nonce:int128 server_nonce:int128 new_nonce_hash:int128 = Server_DH_Params;
server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01C02E4114909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>A0020000</code> (672 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200A37DDE27DD2CD8365E53A44D</code> <code>458FAEC707B84FFD0D1DC60F93EB8DEE</code> <code>86408CDE4D4ACC01DEF41CA8F3F5530C</code> <code>A67C07C60F80B373EB00954BBA8DCA2F</code> <code>EBCC73374855DCACE34A584F835443B1</code> <code>4CF61BB8D50232315B8423C48609B4F9</code> <code>4300AA85ACDD37AE4833CF7262FD78F9</code> <code>E9CF5591CCB137168CCB51C232D0993F</code> <code>B913EBF38428BA714C7C443B5434BFF6</code> <code>EBC2649CD52BE10D91AFEBA29E8FF1CA</code> <code>E7905E05250450E9D4A82D3220A94DE8</code> <code>CEDA2F5B30E5AA1EE5FD30B4F8411D98</code> <code>1BFD7322650801490EBC4B06942493DB</code> <code>B2E3D61AEF428ED963E1696C26420224</code> <code>65D2E457FDF970FC54A168483B26E457</code> <code>DA08A3FA17BC1754E603CDF717C637C2</code> <code>A4716E868E98DA8CEE3C1134620C12A0</code> <code>A0129F136CD1E1F44AC1F6E9DBAB69A8</code> <code>DE5C1E981204955EE6D147CF122BC6D9</code> <code>693CCC31C8462B20512308525C42A244</code> <code>4B0023F31F8491992111D1F70D15B060</code> <code>BC129A98C48B1D3CF782F0808D2479CA</code> <code>42164FFB92FD2C2DCFEB56E4953ECB49</code> <code>6829E6FFBA59FFF5D8A66E4382D3AF89</code> <code>BCA5143834EA4B2C30C7DE8D65A32FA6</code> <code>390D57F7D502578FBA7616200D5B2E5B</code> <code>12A899B8EB10C9EF4835C3B5ED95427F</code> <code>063F0AFD1963ADF65CBC1FEC55CC2822</code> <code>DDDE4A7EEBDCAD6EABADB0CF51A3D0FA</code> <code>5A141B31BBE575187E6D7CCC57977D2E</code> <code>7D86AA505F10F50034586375DCF22B9C</code> <code>91B5B4B01151971E20E101E35418DF6C</code> <code>1E896CBCDF6177FF9003B0DF2175F7A4</code> <code>DC61C6FD7A7654AE504CDCA01A22314B</code> <code>88D54A1BA4D6D490ABFA71DA42893CD8</code> <code>2845FE55DAC268B2001D2B07AF47B509</code> <code>2F2B4A7DFDD098480D53419D52DD9342E6E3F7E1</code></td>
<td>See <a href="#conversion-of-encrypted-answer-into-answer">Decomposition of encrypted_answer »</a></td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<h1><a class="anchor" href="#41-server-dh-inner-data-decryption-and-deserialization" id="41-server-dh-inner-data-decryption-and-deserialization" name="41-server-dh-inner-data-decryption-and-deserialization"><i class="anchor-icon"></i></a>4.1 server_dh_inner_data decryption and deserialization</h1>
<p>Decrypt <code>encrypted_answer</code> using the process specified in step 5.</p>
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 A1 F9 B9 D5 B1 C7 24 55 20 11 1F B7
0010 | 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F 4C 26 45 7B
0020 | 02 94 8D CA 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 09 0D 87 8A 77 0D 8B C3 9F D6 65 02 CC 47 E2 9A
0140 | AE FF D1 27 DD 15 11 90 70 34 FF 46 76 27 A1 76
0150 | 20 B6 C3 21 E5 C0 4F D3 D4 CE 55 D5 F0 EF 86 14
0160 | F8 89 F4 02 EB FC 70 3E 49 94 51 EC 42 69 F1 AB
0170 | 16 88 57 EE 07 38 DB 48 F7 AE 04 22 BC B9 6E 13
0180 | 1D 27 DA 0F 07 DE D6 01 A5 9A 3E 2C 1F 90 F4 DF
0190 | C9 A2 E4 92 44 06 5B 78 59 23 2D F5 65 0F 0F F2
01A0 | 66 40 C5 23 E6 9F 34 DB 38 38 18 BC B8 26 A1 2F
01B0 | EF B9 84 7C 59 11 A6 23 0D 16 FD F6 C3 79 BF 0C
01C0 | 7D E2 2C CD 57 D5 DC F6 A7 4A AC 3F 8E 88 8B A6
01D0 | 7E AD 2C 7F A6 19 72 9B F0 E4 72 B3 8E C6 B9 AE
01E0 | 45 08 A6 BA E5 20 D9 66 11 EC 65 DD AF 4A 95 CE
01F0 | D2 16 B9 96 A1 EB 50 89 AF 75 E2 4F 5F D2 E5 5E
0200 | 71 69 A3 6C 58 9F A1 31 51 2B C9 49 66 7C BD 73
0210 | B7 97 5D 61 44 A9 E3 8B 0C B1 3F D9 3C 06 ED A8
0220 | 4F 84 3C F5 83 71 88 17 E1 54 D8 A5 08 B7 F2 66
0230 | 14 90 9C 64</code></pre>
<p>Payload serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100090D878A770D8BC39FD66502</code> <code>CC47E29AAEFFD127DD1511907034FF46</code> <code>7627A17620B6C321E5C04FD3D4CE55D5</code> <code>F0EF8614F889F402EBFC703E499451EC</code> <code>4269F1AB168857EE0738DB48F7AE0422</code> <code>BCB96E131D27DA0F07DED601A59A3E2C</code> <code>1F90F4DFC9A2E49244065B7859232DF5</code> <code>650F0FF26640C523E69F34DB383818BC</code> <code>B826A12FEFB9847C5911A6230D16FDF6</code> <code>C379BF0C7DE22CCD57D5DCF6A74AAC3F</code> <code>8E888BA67EAD2C7FA619729BF0E472B3</code> <code>8EC6B9AE4508A6BAE520D96611EC65DD</code> <code>AF4A95CED216B996A1EB5089AF75E24F</code> <code>5FD2E55E7169A36C589FA131512BC949</code> <code>667CBD73B7975D6144A9E38B0CB13FD9</code> <code>3C06EDA84F843CF583718817E154D8A508B7F266</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>14909C64</code> (1687982100 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h1><a class="anchor" href="#42-generate-diffie-helman-parameters" id="42-generate-diffie-helman-parameters" name="42-generate-diffie-helman-parameters"><i class="anchor-icon"></i></a>4.2. generate diffie-helman parameters</h1>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = E462A59CDB5CF30663768339228829F5626875E6C4EBD090CED99DAD8E0E8E4FEB63929E982673D12CDF5F5B8C80672DB6631246A7A794EFB29AA9DBCED0750557DE4E552937EF797184693AF0691AB79A66F6A093F8EAD7B3FA9DE8A3672CD2D6DFED1AD93A86A2FE073534FC2C719C2DD1692E5D65A481F312019ADF474503032DA7C24580FB95788EF9D4F222512619FE047D100E96F73E568276D4458B507DA463B19F691BC25571C3E59837ABA05AC5EBBD390126A80E8CCA94661F1BCABEF4A88A646C3D1C0C0CCAC3F5B1471AC5571043094EC328D304A377998992FAA0C46EDADD33FD09C9C727A9583B38192A316BB58C45512DB6C8848904ED7375</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 036B95C4619BE45DA07482AFF85439E8982344A97F94B044DB2F5626A6E7E3B4CDF5B817A1BF5F5E36A528EB21CBD61E8FE69C4DCF4F5BF11C0E6BE0A9097449023527DBCBC767EBDBE443B88D6770094723F99F39F64CA2991AC9E5E2F470BB52068164E846F5E786B4968BB35940B4D41C9F754C85C4E40FC17E90D076D42F55154E0586F0EC67CFD6E8234B82F5D50420EFC121D8EF1D7970B7FC3A7C48334D7339566A462CDC6D67AFCFE643CEA20F1C2EFE09D9E8C5B43D5AC667157601C21DA10DC60357B7496C880E1E172EABF165316A023C1964E01B2AA123927F0C1212558B872E9EC5C7F7E4F6E82F657BF36BEE66D3C311E9342FC1BBE40BCAF0</code></pre>
<!-- end g_b -->
<h1><a class="anchor" href="#43-generation-of-encrypted-data" id="43-generation-of-encrypted-data" name="43-generation-of-encrypted-data"><i class="anchor-icon"></i></a>4.3 generation of encrypted_data</h1>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 A1 F9 B9 D5 B1 C7 24 55 20 11 1F B7
0010 | 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F 4C 26 45 7B
0020 | 02 94 8D CA 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 03 6B 95 C4 61 9B E4 5D A0 74 82 AF F8 54 39 E8
0040 | 98 23 44 A9 7F 94 B0 44 DB 2F 56 26 A6 E7 E3 B4
0050 | CD F5 B8 17 A1 BF 5F 5E 36 A5 28 EB 21 CB D6 1E
0060 | 8F E6 9C 4D CF 4F 5B F1 1C 0E 6B E0 A9 09 74 49
0070 | 02 35 27 DB CB C7 67 EB DB E4 43 B8 8D 67 70 09
0080 | 47 23 F9 9F 39 F6 4C A2 99 1A C9 E5 E2 F4 70 BB
0090 | 52 06 81 64 E8 46 F5 E7 86 B4 96 8B B3 59 40 B4
00A0 | D4 1C 9F 75 4C 85 C4 E4 0F C1 7E 90 D0 76 D4 2F
00B0 | 55 15 4E 05 86 F0 EC 67 CF D6 E8 23 4B 82 F5 D5
00C0 | 04 20 EF C1 21 D8 EF 1D 79 70 B7 FC 3A 7C 48 33
00D0 | 4D 73 39 56 6A 46 2C DC 6D 67 AF CF E6 43 CE A2
00E0 | 0F 1C 2E FE 09 D9 E8 C5 B4 3D 5A C6 67 15 76 01
00F0 | C2 1D A1 0D C6 03 57 B7 49 6C 88 0E 1E 17 2E AB
0100 | F1 65 31 6A 02 3C 19 64 E0 1B 2A A1 23 92 7F 0C
0110 | 12 12 55 8B 87 2E 9E C5 C7 F7 E4 F6 E8 2F 65 7B
0120 | F3 6B EE 66 D3 C3 11 E9 34 2F C1 BB E4 0B CA F0</code></pre>
<p>Payload serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100036B95C4619BE45DA07482AF</code> <code>F85439E8982344A97F94B044DB2F5626</code> <code>A6E7E3B4CDF5B817A1BF5F5E36A528EB</code> <code>21CBD61E8FE69C4DCF4F5BF11C0E6BE0</code> <code>A9097449023527DBCBC767EBDBE443B8</code> <code>8D6770094723F99F39F64CA2991AC9E5</code> <code>E2F470BB52068164E846F5E786B4968B</code> <code>B35940B4D41C9F754C85C4E40FC17E90</code> <code>D076D42F55154E0586F0EC67CFD6E823</code> <code>4B82F5D50420EFC121D8EF1D7970B7FC</code> <code>3A7C48334D7339566A462CDC6D67AFCF</code> <code>E643CEA20F1C2EFE09D9E8C5B43D5AC6</code> <code>67157601C21DA10DC60357B7496C880E</code> <code>1E172EABF165316A023C1964E01B2AA1</code> <code>23927F0C1212558B872E9EC5C7F7E4F6</code> <code>E82F657BF36BEE66D3C311E9342FC1BBE40BCAF0</code></td>
<td><code>pow(g, b) mod dh_prime</code></td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 9).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces some string <strong>data</strong>. This is followed by <strong>encrypted_data</strong>:</p>
<pre><code>data_with_hash := SHA1(data) + data + (0-15 random bytes); such that the length be divisible by 16;
AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv) = 928A4957D0463B525C1CC48AABAA030A256BE5C746792C84CA4C5A0DF60AC799048D98A38A8480EDCF082214DFC79DCB9EE34E206513E2B3BC1504CFE6C9ADA46BF9A03CA74F192EAF8C278454ADABC795A566615462D31817382984039505F71CB33A41E2527A4B1AC05107872FED8E3ABCEE1518AE965B0ED3AED7F67479155BDA8E4C286B64CDF123EC748CF289B1DB02D1907B562DF462D8582BA6F0A3022DC2D3504D69D1BA48B677E3A830BFAFD67584C8AA24E1344A8904E305F9587C92EF964F0083F50F61EAB4A393EAA33C9270294AEDC7732891D4EA1599F52311D74469D2112F4EDF3F342E93C8E87E812DC3989BAECFE6740A46077524C75093F5A5405736DE8937BB6E42C9A0DCF22CA53227D462BCCC2CFE94B6FE86AB7FBFA395021F66661AF7C0024CA2986CA03F3476905407D1EA9C010B763258DB1AA2CC7826D91334EFC1FDC665B67FE45ED0</code></pre>
<p>The length of the final string is 336 bytes.</p>
<h1><a class="anchor" href="#5-request-set-client-dh-params" id="5-request-set-client-dh-params" name="5-request-set-client-dh-params"><i class="anchor-icon"></i></a>5. request set_client_dh_params</h1>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 00 00 00 14 90 9C 64
0010 | 78 01 00 00 1F 5F 04 F5 A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F
0030 | 4C 26 45 7B 02 94 8D CA FE 50 01 00 3E CB CE 83
0040 | 97 30 9D A1 84 5B 93 88 3B 11 99 21 90 FF B9 C5
0050 | 52 26 5C 26 2C 62 77 A3 0E 61 86 2B C5 45 0D 67
0060 | 21 78 1F 07 CE AD 81 67 FE E4 BE 78 4E 4A AF F5
0070 | 73 D9 DD 31 ED 4C 76 48 DB D5 A9 3C F2 90 6E BB
0080 | DE 0C E8 F2 F5 2F D6 81 3C C3 F8 63 46 9C F0 BE
0090 | C7 7A F8 A7 2B 10 1A D6 BB 93 00 1A 20 C9 E8 F0
00A0 | EF A0 AA 45 8E 84 A0 F2 BC 74 D1 BE 4D 7A BB BB
00B0 | EC 9A B6 9B DA C5 7E B7 83 91 51 17 16 83 53 78
00C0 | 7B B6 B6 73 B4 3C BC 33 FC 0B 28 0A CF E7 2E 1B
00D0 | EA 4D B7 EC F6 D6 30 7C CC FB 0F 0C 06 68 68 A3
00E0 | 82 AC EA C6 8E A4 AB 0B 31 3A 16 EF DE 55 C3 4B
00F0 | F4 F1 19 E7 F0 EE 5B D7 79 2F C8 52 23 C1 99 AA
0100 | 79 44 EC 88 11 94 0D CE 47 0C F6 A1 52 23 35 EB
0110 | BA 78 ED F2 59 75 FE 0E BD 06 33 E0 1D EB 6C 87
0120 | 01 A6 BF F1 9A AB 13 BB 3E 1E 4C 17 43 78 04 12
0130 | 45 6E 01 33 B3 70 DC 70 85 20 63 82 20 02 DE 00
0140 | 50 08 9E 37 49 E5 E6 2F D3 B9 8C C0 40 A1 60 45
0150 | 4A 81 56 E6 76 5B 1C 7B 22 D3 67 03 A3 AC D4 6B
0160 | C5 0A F3 73 C2 F0 CC 4A 1C 31 45 30 25 D9 A8 70
0170 | 45 52 BA 9F E5 E7 F3 19 85 B0 54 8A B3 93 33 F9
0180 | DB E9 3C C0 83 FF BD 09 BA 66 DA 06</code></pre>
<p>Payload serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0000000014909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001003ECBCE8397309DA1845B9388</code> <code>3B11992190FFB9C552265C262C6277A3</code> <code>0E61862BC5450D6721781F07CEAD8167</code> <code>FEE4BE784E4AAFF573D9DD31ED4C7648</code> <code>DBD5A93CF2906EBBDE0CE8F2F52FD681</code> <code>3CC3F863469CF0BEC77AF8A72B101AD6</code> <code>BB93001A20C9E8F0EFA0AA458E84A0F2</code> <code>BC74D1BE4D7ABBBBEC9AB69BDAC57EB7</code> <code>83915117168353787BB6B673B43CBC33</code> <code>FC0B280ACFE72E1BEA4DB7ECF6D6307C</code> <code>CCFB0F0C066868A382ACEAC68EA4AB0B</code> <code>313A16EFDE55C34BF4F119E7F0EE5BD7</code> <code>792FC85223C199AA7944EC8811940DCE</code> <code>470CF6A1522335EBBA78EDF25975FE0E</code> <code>BD0633E01DEB6C8701A6BFF19AAB13BB</code> <code>3E1E4C1743780412456E0133B370DC70</code> <code>852063822002DE0050089E3749E5E62F</code> <code>D3B98CC040A160454A8156E6765B1C7B</code> <code>22D36703A3ACD46BC50AF373C2F0CC4A</code> <code>1C31453025D9A8704552BA9FE5E7F319</code> <code>85B0548AB39333F9DBE93CC083FFBD09BA66DA06</code></td>
<td>Encrypted client_DH_inner_data, generated as follows</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h1><a class="anchor" href="#6-auth-key-generation" id="6-auth-key-generation" name="6-auth-key-generation"><i class="anchor-icon"></i></a>6. auth key generation</h1>
<p>The clients computes the auth_key using formula <code>g^{ab} mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 550EABB544BBED3192BDC4914FF864B914BABC8026A4F9E9AD82D6DA35BC8EE141A04978963F9704191F93FDE7C138911610390797D66BAD3EAE14E891EE8F2A5AF52FC392FE98C0EE64DD557179C5D92919C5BE6B7FF5B394A1486C09F2F9BA27484021BAE0B3D65A3BC37CD7086DC58BD9B85B066D971C5BF107CB229700D9A05559D3B2547152124EAA507C4B845D8AD4138F66B671B556A5F686DCC2A5BD4C29352ACD1BA090F8D948FD9A29818CF77EB4C61AC3E9F0DE55B3FEFB89BCDECFED1440E443368F2AC98735FC50448870CD15E9E54015AF11B9DEC1EB3B642A25E396F22C580EF42F7B5D4F41D24C23A412657DB5A203D20EFA29A963C6F1C8</code></pre>
<!-- end auth_key -->
<h1><a class="anchor" href="#7-reply-set-client-dh-params-answer" id="7-reply-set-client-dh-params-answer" name="7-reply-set-client-dh-params-answer"><i class="anchor-icon"></i></a>7. reply set_client_dh_params_answer</h1>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 04 20 8A 14 90 9C 64
0010 | 74 00 00 00 34 F7 CB 3B A1 F9 B9 D5 B1 C7 24 55
0020 | 20 11 1F B7 30 1C 95 C0 70 EA 28 24 B9 2F 73 9F
0030 | 4C 26 45 7B 02 94 8D CA 87 FA CB 12 63 11 10 7E
0040 | CB 62 4A C0 8D 59 55 B4</code></pre>
<p>Payload serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;
dh_gen_retry#46dc1fb9 nonce:int128 server_nonce:int128 new_nonce_hash2:int128 = Set_client_DH_params_answer;
dh_gen_fail#a69dae02 nonce:int128 server_nonce:int128 new_nonce_hash3:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0104208A14909C64</code></td>
<td>Exact <code>unixtime*2^32</code>, <code>+(4*N)</code> if N messages with the same message ID were already generated</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>74000000</code> (116 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>A1F9B9D5B1C7245520111FB7301C95C0</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>70EA2824B92F739F4C26457B02948DCA</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>87FACB126311107ECB624AC08D5955B4</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)">Twitter</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    
    <script>backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

