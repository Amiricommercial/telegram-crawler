<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?236" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 AC 0F 0F 00 D5 F7 85 65
0010 | 14 00 00 00 F1 8E 7E BE F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>AC0F0F00D5F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 E4 41 97 D5 F7 85 65
0010 | 88 00 00 00 63 24 16 05 F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6
0030 | AD DF BD 26 CA 9A FC C4 08 22 BB A4 9C C9 33 B3
0040 | B5 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01E44197D5F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>88000000</code> (136 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>0822BBA49CC933B3B5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2502775011231904693</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2502775011231904693</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2502775011231904693 = 1293611899 * 1934718607</code></p>
<pre><code>p = 1293611899
q = 1934718607</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 22 BB A4 9C C9 33 B3 B5 00 00 00
0010 | 04 4D 1A F3 7B 00 00 00 04 73 51 76 8F 00 00 00
0020 | F8 65 53 B8 A2 25 70 92 30 49 7E FC 0B CD 9A BC
0030 | 6F EE C6 AF 0E 0E AC F6 AD DF BD 26 CA 9A FC C4
0040 | B0 EF F8 70 F2 98 11 C6 EB 1F 02 70 EB 8C 1A 62
0050 | 89 87 DF 50 A2 3F 0F 0F 01 FD 6B 73 5D 0E 71 84
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>0822BBA49CC933B3B5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2502775011231904693</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>044D1AF37B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1293611899</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>047351768F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1934718607</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>B0EFF870F29811C6EB1F0270EB8C1A62</code> <code>8987DF50A23F0F0F01FD6B735D0E7184</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A90822BBA49CC933B3B5000000044D1AF37B000000047351768F000000F86553B8A225709230497EFC0BCD9ABC6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4B0EFF870F29811C6EB1F0270EB8C1A628987DF50A23F0F0F01FD6B735D0E718402000000
random_padding_bytes = 57C530F3CB6A2A9A32BAB2A7B71E9E523B95ADD2A0EC7A5BB1072E95188A9C77AA64AEF4E4F6DB16F0A93941719764414939DF702C40E3B509045F4ED647CD7AE1CA8B1FB98994A296ACDDCF5FE4011832681F459F57A5290D8CF702</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = A042D464B3FA02364F92263167DDD5160D4C346A3910BC4B17268699BECDD6EBB6056A1F1D0E747FDEB2BE1012280A5374A3E44F10F82AA6138DAF6AB9E4517BF11B83E71BFBAD0FCFBDE44DA0D7AA0D2B0464F6479EAB10C11656B8A40AC2AEF6344F11A7A6DB56319AB33EE6D63C105893189DB643F89C49A2D596BD7AF67BF6C577D1DE1CF3128EA698D324968D0C355020004AC840B08982918002E3A7482606A809D69CA5982106ED1B4AD0F190A599C4BC383BB5ED173A6EF45EEFB17C53F442D2AFF470458539DC0A7199EC50001B7186AB0612A98534BC55E0414E05162757A8FFCCDAA966DAB94F6CF42E61EBA79A952983197065B4F13600DE233E</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 B0 0F 0F 00 D5 F7 85 65
0010 | 40 01 00 00 BE E4 12 D7 F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6
0030 | AD DF BD 26 CA 9A FC C4 04 4D 1A F3 7B 00 00 00
0040 | 04 73 51 76 8F 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 A0 42 D4 64 B3 FA 02 36 4F 92 26 31
0060 | 67 DD D5 16 0D 4C 34 6A 39 10 BC 4B 17 26 86 99
0070 | BE CD D6 EB B6 05 6A 1F 1D 0E 74 7F DE B2 BE 10
0080 | 12 28 0A 53 74 A3 E4 4F 10 F8 2A A6 13 8D AF 6A
0090 | B9 E4 51 7B F1 1B 83 E7 1B FB AD 0F CF BD E4 4D
00A0 | A0 D7 AA 0D 2B 04 64 F6 47 9E AB 10 C1 16 56 B8
00B0 | A4 0A C2 AE F6 34 4F 11 A7 A6 DB 56 31 9A B3 3E
00C0 | E6 D6 3C 10 58 93 18 9D B6 43 F8 9C 49 A2 D5 96
00D0 | BD 7A F6 7B F6 C5 77 D1 DE 1C F3 12 8E A6 98 D3
00E0 | 24 96 8D 0C 35 50 20 00 4A C8 40 B0 89 82 91 80
00F0 | 02 E3 A7 48 26 06 A8 09 D6 9C A5 98 21 06 ED 1B
0100 | 4A D0 F1 90 A5 99 C4 BC 38 3B B5 ED 17 3A 6E F4
0110 | 5E EF B1 7C 53 F4 42 D2 AF F4 70 45 85 39 DC 0A
0120 | 71 99 EC 50 00 1B 71 86 AB 06 12 A9 85 34 BC 55
0130 | E0 41 4E 05 16 27 57 A8 FF CC DA A9 66 DA B9 4F
0140 | 6C F4 2E 61 EB A7 9A 95 29 83 19 70 65 B4 F1 36
0150 | 00 DE 23 3E</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>B00F0F00D5F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>044D1AF37B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1293611899</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>047351768F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1934718607</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100A042D464B3FA02364F922631</code> <code>67DDD5160D4C346A3910BC4B17268699</code> <code>BECDD6EBB6056A1F1D0E747FDEB2BE10</code> <code>12280A5374A3E44F10F82AA6138DAF6A</code> <code>B9E4517BF11B83E71BFBAD0FCFBDE44D</code> <code>A0D7AA0D2B0464F6479EAB10C11656B8</code> <code>A40AC2AEF6344F11A7A6DB56319AB33E</code> <code>E6D63C105893189DB643F89C49A2D596</code> <code>BD7AF67BF6C577D1DE1CF3128EA698D3</code> <code>24968D0C355020004AC840B089829180</code> <code>02E3A7482606A809D69CA5982106ED1B</code> <code>4AD0F190A599C4BC383BB5ED173A6EF4</code> <code>5EEFB17C53F442D2AFF470458539DC0A</code> <code>7199EC50001B7186AB0612A98534BC55</code> <code>E0414E05162757A8FFCCDAA966DAB94F</code> <code>6CF42E61EBA79A952983197065B4F136</code><br> <code>00DE233E</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 B8 EC 57 D6 F7 85 65
0010 | 78 02 00 00 5C 07 E8 D0 F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6
0030 | AD DF BD 26 CA 9A FC C4 FE 50 02 00 5A 3F 28 85
0040 | 1C 30 5E 8D 8A BF D2 FF 4C 9E 77 E7 FA 2F 20 3C
0050 | F4 A9 6C CC 76 BE 66 84 FC 98 FE 9A 2B B7 7D 06
0060 | 23 F8 CD 76 CF 2A 7B 27 59 F3 69 C6 FB EE 8B AF
0070 | E9 FC 32 0C 2B D3 84 84 E6 7E C8 24 01 88 16 6A
0080 | 23 58 F6 20 06 1A AD B1 91 33 71 40 BC C3 59 D6
0090 | C0 85 DA 74 57 6A A7 DC D9 24 A5 22 AB A7 44 7C
00A0 | 50 4D 19 95 38 73 84 F7 59 9B 11 71 16 1E A5 6B
00B0 | C5 9A 51 DB 50 4F 20 F4 0F 62 0C 70 D9 4A A6 4E
00C0 | B4 6D 41 99 0F BE E4 35 23 41 66 0C E7 E2 59 FD
00D0 | 25 75 18 9C 56 DC 6A F0 FC 89 64 4B 45 19 B9 1C
00E0 | 27 0C 98 D6 DF 1D FD F9 1B D2 B5 CF 07 76 F8 94
00F0 | 95 B3 75 97 86 D0 24 2E 7B D7 79 01 41 BF 7D FD
0100 | 92 CA F7 85 80 BD DE 6C 4F 5B 12 A5 04 FF 3B 02
0110 | 5F 9F 84 40 7F D0 28 C8 6A 85 DF F6 17 0B 39 7D
0120 | E7 3F 0E 68 78 8A 20 C9 E3 57 84 A2 93 D6 B0 E7
0130 | DA 0E B1 9F 5C FB 85 23 13 E6 BC D1 EF 4C 3D C9
0140 | 3A D3 1A 85 AA 70 26 19 7D 07 94 DB A7 C8 A2 02
0150 | EC 6F C3 39 E3 0F 8B AD 95 56 86 43 82 B7 0D 52
0160 | 21 CB 18 36 DB FD 14 04 5C 5E 08 5A 48 FE 13 BD
0170 | 06 25 B9 96 14 F1 3A 16 7D 11 86 25 7C 16 1D A5
0180 | 71 06 CA A8 F6 57 A0 A9 0F 9C 55 E1 F7 FA E5 15
0190 | 78 32 BB 9E 40 8F B1 C0 E0 C8 13 22 F7 C8 DB 7E
01A0 | FB 1B 07 21 66 42 8E B4 69 63 4A 91 C6 AD 82 9B
01B0 | 3F 65 4C A6 46 F7 EF 22 AC 01 18 48 80 3A AD 64
01C0 | FE F7 C0 73 72 4F 03 E9 9F B6 D9 A1 78 09 16 B8
01D0 | 6B 1E 7C 0B 33 38 52 B7 0B 8B 42 40 C0 B7 D0 87
01E0 | 2E B1 2F BF 51 A9 FD F6 83 F9 B5 E0 43 94 5A 49
01F0 | 83 4F 4E E7 80 DC B4 C7 94 AD D9 38 C7 9D 10 9E
0200 | A6 1B BA FE 3A 02 AE 7F BC 3C 74 0E 04 CD A7 72
0210 | B0 71 8A 37 36 A9 5A 4E C0 8F 42 69 72 B1 58 A6
0220 | 8D AC FD 4C BC 24 E3 E1 B8 09 FD 83 59 6C A0 AF
0230 | 28 EF 10 90 A2 35 DC 9F F4 3B BA CA BC DC 0E AC
0240 | 22 08 33 C6 40 74 79 66 96 72 19 5A 76 F4 3A 22
0250 | BE 32 AE 4A FC 28 CC AB 1A EC 79 AE 24 D2 A2 18
0260 | 57 F9 F4 40 C1 8E E3 8C CA 69 0A 7C 94 40 70 66
0270 | E3 C7 39 77 FE EC 7D C9 3D 39 C6 5B 68 D6 8C D4
0280 | D5 13 80 0A 08 DF 2C 4B 63 6C 79 6C</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01B8EC57D6F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002005A3F28851C305E8D8ABFD2FF</code> <code>4C9E77E7FA2F203CF4A96CCC76BE6684</code> <code>FC98FE9A2BB77D0623F8CD76CF2A7B27</code> <code>59F369C6FBEE8BAFE9FC320C2BD38484</code> <code>E67EC8240188166A2358F620061AADB1</code> <code>91337140BCC359D6C085DA74576AA7DC</code> <code>D924A522ABA7447C504D1995387384F7</code> <code>599B1171161EA56BC59A51DB504F20F4</code> <code>0F620C70D94AA64EB46D41990FBEE435</code> <code>2341660CE7E259FD2575189C56DC6AF0</code> <code>FC89644B4519B91C270C98D6DF1DFDF9</code> <code>1BD2B5CF0776F89495B3759786D0242E</code> <code>7BD7790141BF7DFD92CAF78580BDDE6C</code> <code>4F5B12A504FF3B025F9F84407FD028C8</code> <code>6A85DFF6170B397DE73F0E68788A20C9</code> <code>E35784A293D6B0E7DA0EB19F5CFB8523</code> <code>13E6BCD1EF4C3DC93AD31A85AA702619</code> <code>7D0794DBA7C8A202EC6FC339E30F8BAD</code> <code>9556864382B70D5221CB1836DBFD1404</code> <code>5C5E085A48FE13BD0625B99614F13A16</code> <code>7D1186257C161DA57106CAA8F657A0A9</code> <code>0F9C55E1F7FAE5157832BB9E408FB1C0</code> <code>E0C81322F7C8DB7EFB1B072166428EB4</code> <code>69634A91C6AD829B3F654CA646F7EF22</code> <code>AC011848803AAD64FEF7C073724F03E9</code> <code>9FB6D9A1780916B86B1E7C0B333852B7</code> <code>0B8B4240C0B7D0872EB12FBF51A9FDF6</code> <code>83F9B5E043945A49834F4EE780DCB4C7</code> <code>94ADD938C79D109EA61BBAFE3A02AE7F</code> <code>BC3C740E04CDA772B0718A3736A95A4E</code> <code>C08F426972B158A68DACFD4CBC24E3E1</code> <code>B809FD83596CA0AF28EF1090A235DC9F</code> <code>F43BBACABCDC0EAC220833C640747966</code> <code>9672195A76F43A22BE32AE4AFC28CCAB</code> <code>1AEC79AE24D2A21857F9F440C18EE38C</code> <code>CA690A7C94407066E3C73977FEEC7DC9</code> <code>3D39C65B68D68CD4D513800A08DF2C4B</code><br> <code>636C796C</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 5A3F28851C305E8D8ABFD2FF4C9E77E7FA2F203CF4A96CCC76BE6684FC98FE9A2BB77D0623F8CD76CF2A7B2759F369C6FBEE8BAFE9FC320C2BD38484E67EC8240188166A2358F620061AADB191337140BCC359D6C085DA74576AA7DCD924A522ABA7447C504D1995387384F7599B1171161EA56BC59A51DB504F20F40F620C70D94AA64EB46D41990FBEE4352341660CE7E259FD2575189C56DC6AF0FC89644B4519B91C270C98D6DF1DFDF91BD2B5CF0776F89495B3759786D0242E7BD7790141BF7DFD92CAF78580BDDE6C4F5B12A504FF3B025F9F84407FD028C86A85DFF6170B397DE73F0E68788A20C9E35784A293D6B0E7DA0EB19F5CFB852313E6BCD1EF4C3DC93AD31A85AA7026197D0794DBA7C8A202EC6FC339E30F8BAD9556864382B70D5221CB1836DBFD14045C5E085A48FE13BD0625B99614F13A167D1186257C161DA57106CAA8F657A0A90F9C55E1F7FAE5157832BB9E408FB1C0E0C81322F7C8DB7EFB1B072166428EB469634A91C6AD829B3F654CA646F7EF22AC011848803AAD64FEF7C073724F03E99FB6D9A1780916B86B1E7C0B333852B70B8B4240C0B7D0872EB12FBF51A9FDF683F9B5E043945A49834F4EE780DCB4C794ADD938C79D109EA61BBAFE3A02AE7FBC3C740E04CDA772B0718A3736A95A4EC08F426972B158A68DACFD4CBC24E3E1B809FD83596CA0AF28EF1090A235DC9FF43BBACABCDC0EAC220833C6407479669672195A76F43A22BE32AE4AFC28CCAB1AEC79AE24D2A21857F9F440C18EE38CCA690A7C94407066E3C73977FEEC7DC93D39C65B68D68CD4D513800A08DF2C4B636C796C
tmp_aes_key = 45C7AB984F1592CDDE5AF264AFE1C4870D8A34060F9EB956FC7EEDFC8B0E62D3
tmp_aes_iv = D5BC4AF3EEED52FCD483055306E48EFDA96ABCD7B863C04EC5A6BDB6B0EFF870</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = AA4A7B99B43F4855C91740A36D93C7ED49851BD9BA0D89B5F86553B8A225709230497EFC0BCD9ABC6FEEC6AF0E0EACF6ADDFBD26CA9AFCC403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100608BF52BD3E21BFC441F4749A732F5A86A38F62EBFE2E3505F5AE976B2707D4D4662D94A924892F1C267BCC62E2A6989480DA740E2C2152FB8F4D87D157CFA24D8F810081AD3907B4E7A4B012DC8766A8AB93CA5160E3D9DCF5420C5060630890994D7FC3CA1102BD08BCAF5B43A014BC0E2828DF9EDCC655F133E26BA75DB899BE10DA6CBDAA82D7BADB1193F396EECEABDE3EE4D4AC4AE9186BAB67C687850FF21C6C221555D1696E552D1826E4DF2EC26E5D7F6974B4FD7DE975455D28101E52A346D18FFEED518353FAE35B2F76B5ECD6530A23F8D275748DA7F7A4BE45B22328167FDF960B94BFF35E6721E9E9F87D87DFEDF83D68EDA070986638DF6A1D6F78565A4D74B8AF1D895E3
answer = BA0D89B5F86553B8A225709230497EFC0BCD9ABC6FEEC6AF0E0EACF6ADDFBD26CA9AFCC403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100608BF52BD3E21BFC441F4749A732F5A86A38F62EBFE2E3505F5AE976B2707D4D4662D94A924892F1C267BCC62E2A6989480DA740E2C2152FB8F4D87D157CFA24D8F810081AD3907B4E7A4B012DC8766A8AB93CA5160E3D9DCF5420C5060630890994D7FC3CA1102BD08BCAF5B43A014BC0E2828DF9EDCC655F133E26BA75DB899BE10DA6CBDAA82D7BADB1193F396EECEABDE3EE4D4AC4AE9186BAB67C687850FF21C6C221555D1696E552D1826E4DF2EC26E5D7F6974B4FD7DE975455D28101E52A346D18FFEED518353FAE35B2F76B5ECD6530A23F8D275748DA7F7A4BE45B22328167FDF960B94BFF35E6721E9E9F87D87DFEDF83D68EDA070986638DF6A1D6F78565A4D74B8AF1D895E3</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 F8 65 53 B8 A2 25 70 92 30 49 7E FC
0010 | 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6 AD DF BD 26
0020 | CA 9A FC C4 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 60 8B F5 2B D3 E2 1B FC 44 1F 47 49 A7 32 F5 A8
0140 | 6A 38 F6 2E BF E2 E3 50 5F 5A E9 76 B2 70 7D 4D
0150 | 46 62 D9 4A 92 48 92 F1 C2 67 BC C6 2E 2A 69 89
0160 | 48 0D A7 40 E2 C2 15 2F B8 F4 D8 7D 15 7C FA 24
0170 | D8 F8 10 08 1A D3 90 7B 4E 7A 4B 01 2D C8 76 6A
0180 | 8A B9 3C A5 16 0E 3D 9D CF 54 20 C5 06 06 30 89
0190 | 09 94 D7 FC 3C A1 10 2B D0 8B CA F5 B4 3A 01 4B
01A0 | C0 E2 82 8D F9 ED CC 65 5F 13 3E 26 BA 75 DB 89
01B0 | 9B E1 0D A6 CB DA A8 2D 7B AD B1 19 3F 39 6E EC
01C0 | EA BD E3 EE 4D 4A C4 AE 91 86 BA B6 7C 68 78 50
01D0 | FF 21 C6 C2 21 55 5D 16 96 E5 52 D1 82 6E 4D F2
01E0 | EC 26 E5 D7 F6 97 4B 4F D7 DE 97 54 55 D2 81 01
01F0 | E5 2A 34 6D 18 FF EE D5 18 35 3F AE 35 B2 F7 6B
0200 | 5E CD 65 30 A2 3F 8D 27 57 48 DA 7F 7A 4B E4 5B
0210 | 22 32 81 67 FD F9 60 B9 4B FF 35 E6 72 1E 9E 9F
0220 | 87 D8 7D FE DF 83 D6 8E DA 07 09 86 63 8D F6 A1
0230 | D6 F7 85 65</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100608BF52BD3E21BFC441F4749</code> <code>A732F5A86A38F62EBFE2E3505F5AE976</code> <code>B2707D4D4662D94A924892F1C267BCC6</code> <code>2E2A6989480DA740E2C2152FB8F4D87D</code> <code>157CFA24D8F810081AD3907B4E7A4B01</code> <code>2DC8766A8AB93CA5160E3D9DCF5420C5</code> <code>060630890994D7FC3CA1102BD08BCAF5</code> <code>B43A014BC0E2828DF9EDCC655F133E26</code> <code>BA75DB899BE10DA6CBDAA82D7BADB119</code> <code>3F396EECEABDE3EE4D4AC4AE9186BAB6</code> <code>7C687850FF21C6C221555D1696E552D1</code> <code>826E4DF2EC26E5D7F6974B4FD7DE9754</code> <code>55D28101E52A346D18FFEED518353FAE</code> <code>35B2F76B5ECD6530A23F8D275748DA7F</code> <code>7A4BE45B22328167FDF960B94BFF35E6</code> <code>721E9E9F87D87DFEDF83D68EDA070986</code><br> <code>638DF6A1</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>D6F78565</code> (1703278550 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 8B2BC15FD6534001F46FD1EB85CFC5D33CB492BE3A40B04DC83E193C6CC922F1D0C0351D04E6E1E8F8E253E39E38BE0D3D03DAAF1B640E67228E6B891C5F00CF35360C7B3B5DD5685EDD62A0994D220A459F17A5043AF62930078353C6F0F6213008FC5AF639E27AFE40EF4AD3DC52763C27805EF623B5CB2C29F5176746513B5E448AF01DF862C5692D77464D58789E51FEF300A95D4E8F2C2ECBA4AE6680170770B5C9BC56A50A64C96E56364504570EF355A73E134D241CEF52E0EE6FA616A7B3917BC0CE508967FDC21F079F04C3040C76A8EAE7CCE96196DD0FA4AC75F1366723B4A8A1081D743AEC267E1BAED984CF6F8FECFEBFF41D7827B63B1F9951</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = C345BCB613357FFEC162397048AF74E249AAC8A11209D92EF089A4D341D1B6A361943235F98BF48E7E996F3D90DDEC63F26EBB5740EF0C5F7E25FF1A6C79943E0918C49A5E48D4C9EC7A478F222F067DAC227310383CFA05401503EF8C5CA72CD999E4BF24E80554B265E89DBB6590E90B0B4282803681AAC5C6E71AB4A9C1AE582DB03EBB500633DBD8372D2B1D56923E43D8197070DA2C74AD1E0D245C495B353DFC5123BD5957BA5F69EAEA94994304C3487437FC833B9CBA41C2BBFDE2421D2A1693ADBFE65AE62686A5A7E250AF7B3EF69BA29F9EA1D8CB2B410AF106E31975536335A2F32ECC0DE4A83EEB3D7299551ACFF48D25407FF4C29E1645E173</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 F8 65 53 B8 A2 25 70 92 30 49 7E FC
0010 | 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6 AD DF BD 26
0020 | CA 9A FC C4 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | C3 45 BC B6 13 35 7F FE C1 62 39 70 48 AF 74 E2
0040 | 49 AA C8 A1 12 09 D9 2E F0 89 A4 D3 41 D1 B6 A3
0050 | 61 94 32 35 F9 8B F4 8E 7E 99 6F 3D 90 DD EC 63
0060 | F2 6E BB 57 40 EF 0C 5F 7E 25 FF 1A 6C 79 94 3E
0070 | 09 18 C4 9A 5E 48 D4 C9 EC 7A 47 8F 22 2F 06 7D
0080 | AC 22 73 10 38 3C FA 05 40 15 03 EF 8C 5C A7 2C
0090 | D9 99 E4 BF 24 E8 05 54 B2 65 E8 9D BB 65 90 E9
00A0 | 0B 0B 42 82 80 36 81 AA C5 C6 E7 1A B4 A9 C1 AE
00B0 | 58 2D B0 3E BB 50 06 33 DB D8 37 2D 2B 1D 56 92
00C0 | 3E 43 D8 19 70 70 DA 2C 74 AD 1E 0D 24 5C 49 5B
00D0 | 35 3D FC 51 23 BD 59 57 BA 5F 69 EA EA 94 99 43
00E0 | 04 C3 48 74 37 FC 83 3B 9C BA 41 C2 BB FD E2 42
00F0 | 1D 2A 16 93 AD BF E6 5A E6 26 86 A5 A7 E2 50 AF
0100 | 7B 3E F6 9B A2 9F 9E A1 D8 CB 2B 41 0A F1 06 E3
0110 | 19 75 53 63 35 A2 F3 2E CC 0D E4 A8 3E EB 3D 72
0120 | 99 55 1A CF F4 8D 25 40 7F F4 C2 9E 16 45 E1 73</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100C345BCB613357FFEC1623970</code> <code>48AF74E249AAC8A11209D92EF089A4D3</code> <code>41D1B6A361943235F98BF48E7E996F3D</code> <code>90DDEC63F26EBB5740EF0C5F7E25FF1A</code> <code>6C79943E0918C49A5E48D4C9EC7A478F</code> <code>222F067DAC227310383CFA05401503EF</code> <code>8C5CA72CD999E4BF24E80554B265E89D</code> <code>BB6590E90B0B4282803681AAC5C6E71A</code> <code>B4A9C1AE582DB03EBB500633DBD8372D</code> <code>2B1D56923E43D8197070DA2C74AD1E0D</code> <code>245C495B353DFC5123BD5957BA5F69EA</code> <code>EA94994304C3487437FC833B9CBA41C2</code> <code>BBFDE2421D2A1693ADBFE65AE62686A5</code> <code>A7E250AF7B3EF69BA29F9EA1D8CB2B41</code> <code>0AF106E31975536335A2F32ECC0DE4A8</code> <code>3EEB3D7299551ACFF48D25407FF4C29E</code><br> <code>1645E173</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366F86553B8A225709230497EFC0BCD9ABC6FEEC6AF0E0EACF6ADDFBD26CA9AFCC40000000000000000FE000100C345BCB613357FFEC162397048AF74E249AAC8A11209D92EF089A4D341D1B6A361943235F98BF48E7E996F3D90DDEC63F26EBB5740EF0C5F7E25FF1A6C79943E0918C49A5E48D4C9EC7A478F222F067DAC227310383CFA05401503EF8C5CA72CD999E4BF24E80554B265E89DBB6590E90B0B4282803681AAC5C6E71AB4A9C1AE582DB03EBB500633DBD8372D2B1D56923E43D8197070DA2C74AD1E0D245C495B353DFC5123BD5957BA5F69EAEA94994304C3487437FC833B9CBA41C2BBFDE2421D2A1693ADBFE65AE62686A5A7E250AF7B3EF69BA29F9EA1D8CB2B410AF106E31975536335A2F32ECC0DE4A83EEB3D7299551ACFF48D25407FF4C29E1645E173
padding = 5716BBE199B59207403CDBA3
tmp_aes_key = 45C7AB984F1592CDDE5AF264AFE1C4870D8A34060F9EB956FC7EEDFC8B0E62D3
tmp_aes_iv = D5BC4AF3EEED52FCD483055306E48EFDA96ABCD7B863C04EC5A6BDB6B0EFF870</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = F872E0E5AADE91C4BD03457955C88610A80331C3ABA9C60C8FE526D0836088BA4F1DABAC99201FEB86A1860909D61E26885DA3D540A29E09FBA89B2E4DA63E1E1E9795691CFFAD59F9B775000CA77209660324F90B89186DB0632472135D2991953B611693956AC1FE4ED38A030F544F37201C043FF0D12B3A1DCBC8E5FC746E138D7347F430EC9C1288DBED5DFF77D41AF16C732E3C9719720325BC769D9D7B99E4470D9DC4CCF09B17E21231BF18ED0A156705D772760AF38B7B8B49AEBFE3986CF167E754342BF8430B317117229EF6565E9191E78EBCD936A9F96EB6D6ED84ABC76AA13E6BC3494D26C2FFB674603E1C62A4FA3B942C63CBE0D7CD0661081C49CEAC0951AA8E40339E1D87D4DE1908C8CB89E8F28E2AB87C2A082CF504E3F41FD63BF6CCBA2CE89000BF97673C71584A4C416BA2A12C8F781721C3A0271868D4C01495698C6FB62B53D7B02BFE00</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 14 A4 05 00 D6 F7 85 65
0010 | 78 01 00 00 1F 5F 04 F5 F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6
0030 | AD DF BD 26 CA 9A FC C4 FE 50 01 00 F8 72 E0 E5
0040 | AA DE 91 C4 BD 03 45 79 55 C8 86 10 A8 03 31 C3
0050 | AB A9 C6 0C 8F E5 26 D0 83 60 88 BA 4F 1D AB AC
0060 | 99 20 1F EB 86 A1 86 09 09 D6 1E 26 88 5D A3 D5
0070 | 40 A2 9E 09 FB A8 9B 2E 4D A6 3E 1E 1E 97 95 69
0080 | 1C FF AD 59 F9 B7 75 00 0C A7 72 09 66 03 24 F9
0090 | 0B 89 18 6D B0 63 24 72 13 5D 29 91 95 3B 61 16
00A0 | 93 95 6A C1 FE 4E D3 8A 03 0F 54 4F 37 20 1C 04
00B0 | 3F F0 D1 2B 3A 1D CB C8 E5 FC 74 6E 13 8D 73 47
00C0 | F4 30 EC 9C 12 88 DB ED 5D FF 77 D4 1A F1 6C 73
00D0 | 2E 3C 97 19 72 03 25 BC 76 9D 9D 7B 99 E4 47 0D
00E0 | 9D C4 CC F0 9B 17 E2 12 31 BF 18 ED 0A 15 67 05
00F0 | D7 72 76 0A F3 8B 7B 8B 49 AE BF E3 98 6C F1 67
0100 | E7 54 34 2B F8 43 0B 31 71 17 22 9E F6 56 5E 91
0110 | 91 E7 8E BC D9 36 A9 F9 6E B6 D6 ED 84 AB C7 6A
0120 | A1 3E 6B C3 49 4D 26 C2 FF B6 74 60 3E 1C 62 A4
0130 | FA 3B 94 2C 63 CB E0 D7 CD 06 61 08 1C 49 CE AC
0140 | 09 51 AA 8E 40 33 9E 1D 87 D4 DE 19 08 C8 CB 89
0150 | E8 F2 8E 2A B8 7C 2A 08 2C F5 04 E3 F4 1F D6 3B
0160 | F6 CC BA 2C E8 90 00 BF 97 67 3C 71 58 4A 4C 41
0170 | 6B A2 A1 2C 8F 78 17 21 C3 A0 27 18 68 D4 C0 14
0180 | 95 69 8C 6F B6 2B 53 D7 B0 2B FE 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>14A40500D6F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100F872E0E5AADE91C4BD034579</code> <code>55C88610A80331C3ABA9C60C8FE526D0</code> <code>836088BA4F1DABAC99201FEB86A18609</code> <code>09D61E26885DA3D540A29E09FBA89B2E</code> <code>4DA63E1E1E9795691CFFAD59F9B77500</code> <code>0CA77209660324F90B89186DB0632472</code> <code>135D2991953B611693956AC1FE4ED38A</code> <code>030F544F37201C043FF0D12B3A1DCBC8</code> <code>E5FC746E138D7347F430EC9C1288DBED</code> <code>5DFF77D41AF16C732E3C9719720325BC</code> <code>769D9D7B99E4470D9DC4CCF09B17E212</code> <code>31BF18ED0A156705D772760AF38B7B8B</code> <code>49AEBFE3986CF167E754342BF8430B31</code> <code>7117229EF6565E9191E78EBCD936A9F9</code> <code>6EB6D6ED84ABC76AA13E6BC3494D26C2</code> <code>FFB674603E1C62A4FA3B942C63CBE0D7</code> <code>CD0661081C49CEAC0951AA8E40339E1D</code> <code>87D4DE1908C8CB89E8F28E2AB87C2A08</code> <code>2CF504E3F41FD63BF6CCBA2CE89000BF</code> <code>97673C71584A4C416BA2A12C8F781721</code> <code>C3A0271868D4C01495698C6FB62B53D7</code><br> <code>B02BFE00</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 58ABE6B4D20D52939B1A7D4A066FE9D94B893258701F5F2518EEBE068F33D13E89586194A33C7C6A9C4E17B0DEE95AED5F7B2C0EA20BA0034FAEDA104E17EC75D9FAF5B157E36C13949573AE2AD13A7A00D4087D046ABA8073836847F3B0C60BCA9563F1A630AB351AE48C44BB3147B0D0D09233B5BEDC3C534D7D40BCB16E296114D8C1EC56920CB986E61ECFC782BDD92DC2C0FDD51DFB6A5B4F19B110DF1B8AA21E467BC2C0573AEBD84AFC447618E2124F13A0B38409E8F2E42179196285F5CC50844AA6F2FA30F23914B036D629085CB65FADEA658C80333A3BAE61025A781817BA0015931698BCC04E03B157891966E69BAAAC013477286FBA0627B845</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 FC 5B AA D6 F7 85 65
0010 | AC 00 00 00 34 F7 CB 3B F8 65 53 B8 A2 25 70 92
0020 | 30 49 7E FC 0B CD 9A BC 6F EE C6 AF 0E 0E AC F6
0030 | AD DF BD 26 CA 9A FC C4 A1 08 F6 6E E0 B5 8C 3A
0040 | E0 85 4D CA BA 23 BF 61</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01FC5BAAD6F78565</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>AC000000</code> (172 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F86553B8A225709230497EFC0BCD9ABC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6FEEC6AF0E0EACF6ADDFBD26CA9AFCC4</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>A108F66EE0B58C3AE0854DCABA23BF61</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

